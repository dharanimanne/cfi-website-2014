/*
This software is allowed to use under GPL or you need to obtain Commercial or Enterise License
to use it in non-GPL project. Please contact sales@dhtmlx.com for details
*/

window.dhtmlx||(dhtmlx=function(a){for(var b in a)dhtmlx[b]=a[b];return dhtmlx});
dhtmlx.extend_api=function(a,b,c){var d=window[a];if(d)window[a]=function(a){if(a&&typeof a=="object"&&!a.tagName){var c=d.apply(this,b._init?b._init(a):arguments),g;for(g in dhtmlx)if(b[g])this[b[g]](dhtmlx[g]);for(g in a)if(b[g])this[b[g]](a[g]);else g.indexOf("on")==0&&this.attachEvent(g,a[g])}else c=d.apply(this,arguments);b._patch&&b._patch(this);return c||this},window[a].prototype=d.prototype,c&&dhtmlXHeir(window[a].prototype,c)};
dhtmlxAjax={get:function(a,b){var c=new dtmlXMLLoaderObject(!0);c.async=arguments.length<3;c.waitCall=b;c.loadXML(a);return c},post:function(a,b,c){var d=new dtmlXMLLoaderObject(!0);d.async=arguments.length<4;d.waitCall=c;d.loadXML(a,!0,b);return d},getSync:function(a){return this.get(a,null,!0)},postSync:function(a,b){return this.post(a,b,null,!0)}};
function dtmlXMLLoaderObject(a,b,c,d){this.xmlDoc="";this.async=typeof c!="undefined"?c:!0;this.onloadAction=a||null;this.mainObject=b||null;this.waitCall=null;this.rSeed=d||!1;return this}dtmlXMLLoaderObject.count=0;
dtmlXMLLoaderObject.prototype.waitLoadFunction=function(a){var b=!0;return this.check=function(){if(a&&a.onloadAction!=null&&(!a.xmlDoc.readyState||a.xmlDoc.readyState==4)&&b){b=!1;dtmlXMLLoaderObject.count++;if(typeof a.onloadAction=="function")a.onloadAction(a.mainObject,null,null,null,a);if(a.waitCall)a.waitCall.call(this,a),a.waitCall=null}}};
dtmlXMLLoaderObject.prototype.getXMLTopNode=function(a,b){if(this.xmlDoc.responseXML){var c=this.xmlDoc.responseXML.getElementsByTagName(a);c.length==0&&a.indexOf(":")!=-1&&(c=this.xmlDoc.responseXML.getElementsByTagName(a.split(":")[1]));var d=c[0]}else d=this.xmlDoc.documentElement;if(d)return this._retry=!1,d;if(!this._retry&&_isIE)return this._retry=!0,b=this.xmlDoc,this.loadXMLString(this.xmlDoc.responseText.replace(/^[\s]+/,""),!0),this.getXMLTopNode(a,b);dhtmlxError.throwError("LoadXML","Incorrect XML",
[b||this.xmlDoc,this.mainObject]);return document.createElement("DIV")};dtmlXMLLoaderObject.prototype.loadXMLString=function(a,b){if(_isIE)this.xmlDoc=new ActiveXObject("Microsoft.XMLDOM"),this.xmlDoc.async=this.async,this.xmlDoc.onreadystatechange=function(){},this.xmlDoc.loadXML(a);else{var c=new DOMParser;this.xmlDoc=c.parseFromString(a,"text/xml")}if(!b){if(this.onloadAction)this.onloadAction(this.mainObject,null,null,null,this);if(this.waitCall)this.waitCall(),this.waitCall=null}};
dtmlXMLLoaderObject.prototype.loadXML=function(a,b,c,d){this.rSeed&&(a+=(a.indexOf("?")!=-1?"&":"?")+"a_dhx_rSeed="+(new Date).valueOf());this.filePath=a;this.xmlDoc=!_isIE&&window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");if(this.async)this.xmlDoc.onreadystatechange=new this.waitLoadFunction(this);this.xmlDoc.open(b?"POST":"GET",a,this.async);d?(this.xmlDoc.setRequestHeader("User-Agent","dhtmlxRPC v0.1 ("+navigator.userAgent+")"),this.xmlDoc.setRequestHeader("Content-type",
"text/xml")):b&&this.xmlDoc.setRequestHeader("Content-type","application/x-www-form-urlencoded");this.xmlDoc.setRequestHeader("X-Requested-With","XMLHttpRequest");this.xmlDoc.send(c);this.async||(new this.waitLoadFunction(this))()};
dtmlXMLLoaderObject.prototype.destructor=function(){return this.setXSLParamValue=this.getXMLTopNode=this.xmlNodeToJSON=this.doSerialization=this.loadXMLString=this.loadXML=this.doXSLTransToString=this.doXSLTransToObject=this.doXPathOpera=this.doXPath=this.xmlDoc=this.mainObject=this.onloadAction=this.filePath=this.rSeed=this.async=this._retry=this._getAllNamedChilds=this._filterXPath=null};
dtmlXMLLoaderObject.prototype.xmlNodeToJSON=function(a){for(var b={},c=0;c<a.attributes.length;c++)b[a.attributes[c].name]=a.attributes[c].value;b._tagvalue=a.firstChild?a.firstChild.nodeValue:"";for(c=0;c<a.childNodes.length;c++){var d=a.childNodes[c].tagName;d&&(b[d]||(b[d]=[]),b[d].push(this.xmlNodeToJSON(a.childNodes[c])))}return b};function callerFunction(a,b){return this.handler=function(c){if(!c)c=window.event;a(c,b);return!0}}function getAbsoluteLeft(a){return getOffset(a).left}
function getAbsoluteTop(a){return getOffset(a).top}function getOffsetSum(a){for(var b=0,c=0;a;)b+=parseInt(a.offsetTop),c+=parseInt(a.offsetLeft),a=a.offsetParent;return{top:b,left:c}}
function getOffsetRect(a){var b=a.getBoundingClientRect(),c=document.body,d=document.documentElement,e=window.pageYOffset||d.scrollTop||c.scrollTop,f=window.pageXOffset||d.scrollLeft||c.scrollLeft,g=d.clientTop||c.clientTop||0,h=d.clientLeft||c.clientLeft||0,i=b.top+e-g,j=b.left+f-h;return{top:Math.round(i),left:Math.round(j)}}function getOffset(a){return a.getBoundingClientRect?getOffsetRect(a):getOffsetSum(a)}
function convertStringToBoolean(a){typeof a=="string"&&(a=a.toLowerCase());switch(a){case "1":case "true":case "yes":case "y":case 1:case !0:return!0;default:return!1}}function getUrlSymbol(a){return a.indexOf("?")!=-1?"&":"?"}function dhtmlDragAndDropObject(){if(window.dhtmlDragAndDrop)return window.dhtmlDragAndDrop;this.dragStartObject=this.dragStartNode=this.dragNode=this.lastLanding=0;this.tempDOMM=this.tempDOMU=null;this.waitDrag=0;window.dhtmlDragAndDrop=this;return this}
dhtmlDragAndDropObject.prototype.removeDraggableItem=function(a){a.onmousedown=null;a.dragStarter=null;a.dragLanding=null};dhtmlDragAndDropObject.prototype.addDraggableItem=function(a,b){a.onmousedown=this.preCreateDragCopy;a.dragStarter=b;this.addDragLanding(a,b)};dhtmlDragAndDropObject.prototype.addDragLanding=function(a,b){a.dragLanding=b};
dhtmlDragAndDropObject.prototype.preCreateDragCopy=function(a){if(!((a||window.event)&&(a||event).button==2)){if(window.dhtmlDragAndDrop.waitDrag)return window.dhtmlDragAndDrop.waitDrag=0,document.body.onmouseup=window.dhtmlDragAndDrop.tempDOMU,document.body.onmousemove=window.dhtmlDragAndDrop.tempDOMM,!1;window.dhtmlDragAndDrop.dragNode&&window.dhtmlDragAndDrop.stopDrag(a);window.dhtmlDragAndDrop.waitDrag=1;window.dhtmlDragAndDrop.tempDOMU=document.body.onmouseup;window.dhtmlDragAndDrop.tempDOMM=
document.body.onmousemove;window.dhtmlDragAndDrop.dragStartNode=this;window.dhtmlDragAndDrop.dragStartObject=this.dragStarter;document.body.onmouseup=window.dhtmlDragAndDrop.preCreateDragCopy;document.body.onmousemove=window.dhtmlDragAndDrop.callDrag;window.dhtmlDragAndDrop.downtime=(new Date).valueOf();a&&a.preventDefault&&a.preventDefault();return!1}};
dhtmlDragAndDropObject.prototype.callDrag=function(a){if(!a)a=window.event;dragger=window.dhtmlDragAndDrop;if(!((new Date).valueOf()-dragger.downtime<100)){if(!dragger.dragNode)if(dragger.waitDrag){dragger.dragNode=dragger.dragStartObject._createDragNode(dragger.dragStartNode,a);if(!dragger.dragNode)return dragger.stopDrag();dragger.dragNode.onselectstart=function(){return!1};dragger.gldragNode=dragger.dragNode;document.body.appendChild(dragger.dragNode);document.body.onmouseup=dragger.stopDrag;dragger.waitDrag=
0;dragger.dragNode.pWindow=window;dragger.initFrameRoute()}else return dragger.stopDrag(a,!0);if(dragger.dragNode.parentNode!=window.document.body&&dragger.gldragNode){var b=dragger.gldragNode;if(dragger.gldragNode.old)b=dragger.gldragNode.old;b.parentNode.removeChild(b);var c=dragger.dragNode.pWindow;b.pWindow&&b.pWindow.dhtmlDragAndDrop.lastLanding&&b.pWindow.dhtmlDragAndDrop.lastLanding.dragLanding._dragOut(b.pWindow.dhtmlDragAndDrop.lastLanding);if(_isIE){var d=document.createElement("Div");d.innerHTML=
dragger.dragNode.outerHTML;dragger.dragNode=d.childNodes[0]}else dragger.dragNode=dragger.dragNode.cloneNode(!0);dragger.dragNode.pWindow=window;dragger.gldragNode.old=dragger.dragNode;document.body.appendChild(dragger.dragNode);c.dhtmlDragAndDrop.dragNode=dragger.dragNode}dragger.dragNode.style.left=a.clientX+15+(dragger.fx?dragger.fx*-1:0)+(document.body.scrollLeft||document.documentElement.scrollLeft)+"px";dragger.dragNode.style.top=a.clientY+3+(dragger.fy?dragger.fy*-1:0)+(document.body.scrollTop||
document.documentElement.scrollTop)+"px";var e=a.srcElement?a.srcElement:a.target;dragger.checkLanding(e,a)}};dhtmlDragAndDropObject.prototype.calculateFramePosition=function(a){if(window.name){for(var b=parent.frames[window.name].frameElement.offsetParent,c=0,d=0;b;)c+=b.offsetLeft,d+=b.offsetTop,b=b.offsetParent;if(parent.dhtmlDragAndDrop){var e=parent.dhtmlDragAndDrop.calculateFramePosition(1);c+=e.split("_")[0]*1;d+=e.split("_")[1]*1}if(a)return c+"_"+d;else this.fx=c;this.fy=d}return"0_0"};
dhtmlDragAndDropObject.prototype.checkLanding=function(a,b){a&&a.dragLanding?(this.lastLanding&&this.lastLanding.dragLanding._dragOut(this.lastLanding),this.lastLanding=a,this.lastLanding=this.lastLanding.dragLanding._dragIn(this.lastLanding,this.dragStartNode,b.clientX,b.clientY,b),this.lastLanding_scr=_isIE?b.srcElement:b.target):a&&a.tagName!="BODY"?this.checkLanding(a.parentNode,b):(this.lastLanding&&this.lastLanding.dragLanding._dragOut(this.lastLanding,b.clientX,b.clientY,b),this.lastLanding=
0,this._onNotFound&&this._onNotFound())};
dhtmlDragAndDropObject.prototype.stopDrag=function(a,b){dragger=window.dhtmlDragAndDrop;if(!b){dragger.stopFrameRoute();var c=dragger.lastLanding;dragger.lastLanding=null;c&&c.dragLanding._drag(dragger.dragStartNode,dragger.dragStartObject,c,_isIE?event.srcElement:a.target)}dragger.lastLanding=null;dragger.dragNode&&dragger.dragNode.parentNode==document.body&&dragger.dragNode.parentNode.removeChild(dragger.dragNode);dragger.dragNode=0;dragger.gldragNode=0;dragger.fx=0;dragger.fy=0;dragger.dragStartNode=
0;dragger.dragStartObject=0;document.body.onmouseup=dragger.tempDOMU;document.body.onmousemove=dragger.tempDOMM;dragger.tempDOMU=null;dragger.tempDOMM=null;dragger.waitDrag=0};dhtmlDragAndDropObject.prototype.stopFrameRoute=function(a){a&&window.dhtmlDragAndDrop.stopDrag(1,1);for(var b=0;b<window.frames.length;b++)try{window.frames[b]!=a&&window.frames[b].dhtmlDragAndDrop&&window.frames[b].dhtmlDragAndDrop.stopFrameRoute(window)}catch(c){}try{parent.dhtmlDragAndDrop&&parent!=window&&parent!=a&&parent.dhtmlDragAndDrop.stopFrameRoute(window)}catch(d){}};
dhtmlDragAndDropObject.prototype.initFrameRoute=function(a,b){if(a)window.dhtmlDragAndDrop.preCreateDragCopy(),window.dhtmlDragAndDrop.dragStartNode=a.dhtmlDragAndDrop.dragStartNode,window.dhtmlDragAndDrop.dragStartObject=a.dhtmlDragAndDrop.dragStartObject,window.dhtmlDragAndDrop.dragNode=a.dhtmlDragAndDrop.dragNode,window.dhtmlDragAndDrop.gldragNode=a.dhtmlDragAndDrop.dragNode,window.document.body.onmouseup=window.dhtmlDragAndDrop.stopDrag,window.waitDrag=0,!_isIE&&b&&(!_isFF||_FFrv<1.8)&&window.dhtmlDragAndDrop.calculateFramePosition();
try{parent.dhtmlDragAndDrop&&parent!=window&&parent!=a&&parent.dhtmlDragAndDrop.initFrameRoute(window)}catch(c){}for(var d=0;d<window.frames.length;d++)try{window.frames[d]!=a&&window.frames[d].dhtmlDragAndDrop&&window.frames[d].dhtmlDragAndDrop.initFrameRoute(window,!a||b?1:0)}catch(e){}};_OperaRv=_KHTMLrv=_FFrv=_isChrome=_isMacOS=_isKHTML=_isOpera=_isIE=_isFF=!1;navigator.userAgent.indexOf("Macintosh")!=-1&&(_isMacOS=!0);navigator.userAgent.toLowerCase().indexOf("chrome")>-1&&(_isChrome=!0);
if(navigator.userAgent.indexOf("Safari")!=-1||navigator.userAgent.indexOf("Konqueror")!=-1)_KHTMLrv=parseFloat(navigator.userAgent.substr(navigator.userAgent.indexOf("Safari")+7,5)),_KHTMLrv>525?(_isFF=!0,_FFrv=1.9):_isKHTML=!0;else if(navigator.userAgent.indexOf("Opera")!=-1)_isOpera=!0,_OperaRv=parseFloat(navigator.userAgent.substr(navigator.userAgent.indexOf("Opera")+6,3));else if(navigator.appName.indexOf("Microsoft")!=-1){if(_isIE=!0,(navigator.appVersion.indexOf("MSIE 8.0")!=-1||navigator.appVersion.indexOf("MSIE 9.0")!=
-1||navigator.appVersion.indexOf("MSIE 10.0")!=-1)&&document.compatMode!="BackCompat")_isIE=8}else _isFF=!0,_FFrv=parseFloat(navigator.userAgent.split("rv:")[1]);
dtmlXMLLoaderObject.prototype.doXPath=function(a,b,c,d){if(_isKHTML||!_isIE&&!window.XPathResult)return this.doXPathOpera(a,b);if(_isIE)return b||(b=this.xmlDoc.nodeName?this.xmlDoc:this.xmlDoc.responseXML),b||dhtmlxError.throwError("LoadXML","Incorrect XML",[b||this.xmlDoc,this.mainObject]),c!=null&&b.setProperty("SelectionNamespaces","xmlns:xsl='"+c+"'"),d=="single"?b.selectSingleNode(a):b.selectNodes(a)||[];else{var e=b;b||(b=this.xmlDoc.nodeName?this.xmlDoc:this.xmlDoc.responseXML);b||dhtmlxError.throwError("LoadXML",
"Incorrect XML",[b||this.xmlDoc,this.mainObject]);b.nodeName.indexOf("document")!=-1?e=b:(e=b,b=b.ownerDocument);var f=XPathResult.ANY_TYPE;if(d=="single")f=XPathResult.FIRST_ORDERED_NODE_TYPE;var g=[],h=b.evaluate(a,e,function(){return c},f,null);if(f==XPathResult.FIRST_ORDERED_NODE_TYPE)return h.singleNodeValue;for(var i=h.iterateNext();i;)g[g.length]=i,i=h.iterateNext();return g}};function v(){if(!this.catches)this.catches=[];return this}v.prototype.catchError=function(a,b){this.catches[a]=b};
v.prototype.throwError=function(a,b,c){if(this.catches[a])return this.catches[a](a,b,c);if(this.catches.ALL)return this.catches.ALL(a,b,c);alert("Error type: "+a+"\nDescription: "+b);return null};window.dhtmlxError=new v;
dtmlXMLLoaderObject.prototype.doXPathOpera=function(a,b){var c=a.replace(/[\/]+/gi,"/").split("/"),d=null,e=1;if(!c.length)return[];if(c[0]==".")d=[b];else if(c[0]=="")d=(this.xmlDoc.responseXML||this.xmlDoc).getElementsByTagName(c[e].replace(/\[[^\]]*\]/g,"")),e++;else return[];for(;e<c.length;e++)d=this._getAllNamedChilds(d,c[e]);c[e-1].indexOf("[")!=-1&&(d=this._filterXPath(d,c[e-1]));return d};
dtmlXMLLoaderObject.prototype._filterXPath=function(a,b){for(var c=[],b=b.replace(/[^\[]*\[\@/g,"").replace(/[\[\]\@]*/g,""),d=0;d<a.length;d++)a[d].getAttribute(b)&&(c[c.length]=a[d]);return c};
dtmlXMLLoaderObject.prototype._getAllNamedChilds=function(a,b){var c=[];_isKHTML&&(b=b.toUpperCase());for(var d=0;d<a.length;d++)for(var e=0;e<a[d].childNodes.length;e++)_isKHTML?a[d].childNodes[e].tagName&&a[d].childNodes[e].tagName.toUpperCase()==b&&(c[c.length]=a[d].childNodes[e]):a[d].childNodes[e].tagName==b&&(c[c.length]=a[d].childNodes[e]);return c};function dhtmlXHeir(a,b){for(var c in b)typeof b[c]=="function"&&(a[c]=b[c]);return a}
function dhtmlxEvent(a,b,c){a.addEventListener?a.addEventListener(b,c,!1):a.attachEvent&&a.attachEvent("on"+b,c)}dtmlXMLLoaderObject.prototype.xslDoc=null;dtmlXMLLoaderObject.prototype.setXSLParamValue=function(a,b,c){if(!c)c=this.xslDoc;if(c.responseXML)c=c.responseXML;var d=this.doXPath("/xsl:stylesheet/xsl:variable[@name='"+a+"']",c,"http://www.w3.org/1999/XSL/Transform","single");if(d!=null)d.firstChild.nodeValue=b};
dtmlXMLLoaderObject.prototype.doXSLTransToObject=function(a,b){if(!a)a=this.xslDoc;if(a.responseXML)a=a.responseXML;if(!b)b=this.xmlDoc;if(b.responseXML)b=b.responseXML;if(_isIE){d=new ActiveXObject("Msxml2.DOMDocument.3.0");try{b.transformNodeToObject(a,d)}catch(c){d=b.transformNode(a)}}else{if(!this.XSLProcessor)this.XSLProcessor=new XSLTProcessor,this.XSLProcessor.importStylesheet(a);var d=this.XSLProcessor.transformToDocument(b)}return d};
dtmlXMLLoaderObject.prototype.doXSLTransToString=function(a,b){var c=this.doXSLTransToObject(a,b);return typeof c=="string"?c:this.doSerialization(c)};dtmlXMLLoaderObject.prototype.doSerialization=function(a){if(!a)a=this.xmlDoc;if(a.responseXML)a=a.responseXML;if(_isIE)return a.xml;else{var b=new XMLSerializer;return b.serializeToString(a)}};
dhtmlxEventable=function(a){a.attachEvent=function(a,c,d){a="ev_"+a.toLowerCase();this[a]||(this[a]=new this.eventCatcher(d||this));return a+":"+this[a].addEvent(c)};a.callEvent=function(a,c){a="ev_"+a.toLowerCase();return this[a]?this[a].apply(this,c):!0};a.checkEvent=function(a){return!!this["ev_"+a.toLowerCase()]};a.eventCatcher=function(a){var c=[],d=function(){for(var d=!0,f=0;f<c.length;f++)if(c[f]!=null)var g=c[f].apply(a,arguments),d=d&&g;return d};d.addEvent=function(a){typeof a!="function"&&
(a=eval(a));return a?c.push(a)-1:!1};d.removeEvent=function(a){c[a]=null};return d};a.detachEvent=function(a){if(a!=!1){var c=a.split(":");this[c[0]].removeEvent(c[1])}};a.detachAllEvents=function(){for(var a in this)a.indexOf("ev_")==0&&(this.detachEvent(a),this[a]=null)};a=null};if(!window.dhtmlx)window.dhtmlx={};
(function(){function a(a,b){var d=a.callback;c(!1);a.box.parentNode.removeChild(a.box);l=a.box=null;d&&d(b)}function b(b){if(l){var b=b||event,c=b.which||event.keyCode;dhtmlx.message.keyboard&&((c==13||c==32)&&a(l,!0),c==27&&a(l,!1));b.preventDefault&&b.preventDefault();return!(b.cancelBubble=!0)}}function c(a){if(!c.cover)c.cover=document.createElement("DIV"),c.cover.onkeydown=b,c.cover.className="dhx_modal_cover",document.body.appendChild(c.cover);var d=document.body.scrollHeight;c.cover.style.display=
a?"inline-block":"none"}function d(a,b){var c="dhtmlx_"+a.toLowerCase().replace(/ /g,"_")+"_button";return"<div class='dhtmlx_popup_button "+c+"' result='"+b+"' ><div>"+a+"</div></div>"}function e(a){if(!m.area)m.area=document.createElement("DIV"),m.area.className="dhtmlx_message_area",m.area.style[m.position]="5px",document.body.appendChild(m.area);m.hide(a.id);var b=document.createElement("DIV");b.innerHTML="<div>"+a.text+"</div>";b.className="dhtmlx-info dhtmlx-"+a.type;b.onclick=function(){m.hide(a.id);
a=null};m.position=="bottom"&&m.area.firstChild?m.area.insertBefore(b,m.area.firstChild):m.area.appendChild(b);a.expire>0&&(m.timers[a.id]=window.setTimeout(function(){m.hide(a.id)},a.expire));m.pull[a.id]=b;b=null;return a.id}function f(b,c,e){var f=document.createElement("DIV");f.className=" dhtmlx_modal_box dhtmlx-"+b.type;f.setAttribute("dhxbox",1);var g="";if(b.width)f.style.width=b.width;if(b.height)f.style.height=b.height;b.title&&(g+='<div class="dhtmlx_popup_title">'+b.title+"</div>");g+=
'<div class="dhtmlx_popup_text"><span>'+(b.content?"":b.text)+'</span></div><div  class="dhtmlx_popup_controls">';c&&(g+=d(b.ok||"OK",!0));e&&(g+=d(b.cancel||"Cancel",!1));if(b.buttons)for(var h=0;h<b.buttons.length;h++)g+=d(b.buttons[h],h);g+="</div>";f.innerHTML=g;if(b.content){var i=b.content;typeof i=="string"&&(i=document.getElementById(i));if(i.style.display=="none")i.style.display="";f.childNodes[b.title?1:0].appendChild(i)}f.onclick=function(c){var c=c||event,d=c.target||c.srcElement;if(!d.className)d=
d.parentNode;if(d.className.split(" ")[0]=="dhtmlx_popup_button"){var e=d.getAttribute("result"),e=e=="true"||(e=="false"?!1:e);a(b,e)}};b.box=f;if(c||e)l=b;return f}function g(a,d,e){var g=a.tagName?a:f(a,d,e);a.hidden||c(!0);document.body.appendChild(g);var h=Math.abs(Math.floor(((window.innerWidth||document.documentElement.offsetWidth)-g.offsetWidth)/2)),i=Math.abs(Math.floor(((window.innerHeight||document.documentElement.offsetHeight)-g.offsetHeight)/2));g.style.top=a.position=="top"?"-3px":i+
"px";g.style.left=h+"px";g.onkeydown=b;g.focus();a.hidden&&dhtmlx.modalbox.hide(g);return g}function h(a){return g(a,!0,!1)}function i(a){return g(a,!0,!0)}function j(a){return g(a)}function k(a,b,c){typeof a!="object"&&(typeof b=="function"&&(c=b,b=""),a={text:a,type:b,callback:c});return a}function n(a,b,c,d){typeof a!="object"&&(a={text:a,type:b,expire:c,id:d});a.id=a.id||m.uid();a.expire=a.expire||m.expire;return a}var l=null;document.attachEvent?document.attachEvent("onkeydown",b):document.addEventListener("keydown",
b,!0);dhtmlx.alert=function(){var a=k.apply(this,arguments);a.type=a.type||"confirm";return h(a)};dhtmlx.confirm=function(){var a=k.apply(this,arguments);a.type=a.type||"alert";return i(a)};dhtmlx.modalbox=function(){var a=k.apply(this,arguments);a.type=a.type||"alert";return j(a)};dhtmlx.modalbox.hide=function(a){for(;a&&a.getAttribute&&!a.getAttribute("dhxbox");)a=a.parentNode;a&&(a.parentNode.removeChild(a),c(!1))};var m=dhtmlx.message=function(a,b,c,d){a=n.apply(this,arguments);a.type=a.type||
"info";var f=a.type.split("-")[0];switch(f){case "alert":return h(a);case "confirm":return i(a);case "modalbox":return j(a);default:return e(a)}};m.seed=(new Date).valueOf();m.uid=function(){return m.seed++};m.expire=4E3;m.keyboard=!0;m.position="top";m.pull={};m.timers={};m.hideAll=function(){for(var a in m.pull)m.hide(a)};m.hide=function(a){var b=m.pull[a];b&&b.parentNode&&(window.setTimeout(function(){b.parentNode.removeChild(b);b=null},2E3),b.className+=" hidden",m.timers[a]&&window.clearTimeout(m.timers[a]),
delete m.pull[a])}})();gantt={version:"2.0.0"};function dhtmlxDetachEvent(a,b,c){a.removeEventListener?a.removeEventListener(b,c,!1):a.detachEvent&&a.detachEvent("on"+b,c)}
dhtmlxEventable=function(a){a._silent_mode=!1;a._silentStart=function(){this._silent_mode=!0};a._silentEnd=function(){this._silent_mode=!1};a.attachEvent=function(a,c,d){a="ev_"+a.toLowerCase();this[a]||(this[a]=new this._eventCatcher(d||this));return a+":"+this[a].addEvent(c)};a.callEvent=function(a,c){if(this._silent_mode)return!0;a="ev_"+a.toLowerCase();return this[a]?this[a].apply(this,c):!0};a.checkEvent=function(a){return!!this["ev_"+a.toLowerCase()]};a._eventCatcher=function(a){var c=[],d=
function(){for(var d=!0,f=0;f<c.length;f++)if(c[f]!=null)var g=c[f].apply(a,arguments),d=d&&g;return d};d.addEvent=function(a){typeof a!="function"&&(a=eval(a));return a?c.push(a)-1:!1};d.removeEvent=function(a){c[a]=null};return d};a.detachEvent=function(a){if(a!=!1){var c=a.split(":");this[c[0]].removeEvent(c[1])}};a.detachAllEvents=function(){for(var a in this)a.indexOf("ev_")==0&&delete this[a]};a=null};
dhtmlx.copy=function(a){var b,c,d;if(a&&typeof a=="object"){d={};c=[Array,Date,Number,String,Boolean];for(b=0;b<c.length;b++)a instanceof c[b]&&(d=b?new c[b](a):new c[b]);for(b in a)Object.prototype.hasOwnProperty.apply(a,[b])&&(d[b]=dhtmlx.copy(a[b]))}return d||a};dhtmlx.mixin=function(a,b,c){for(var d in b)if(!a[d]||c)a[d]=b[d];return a};dhtmlx.defined=function(a){return typeof a!="undefined"};dhtmlx.uid=function(){if(!this._seed)this._seed=(new Date).valueOf();this._seed++;return this._seed};
dhtmlx.bind=function(a,b){return function(){return a.apply(b,arguments)}};
gantt._get_position=function(a){if(a.getBoundingClientRect){var b=a.getBoundingClientRect(),c=document.body,d=document.documentElement,e=window.pageYOffset||d.scrollTop||c.scrollTop,f=window.pageXOffset||d.scrollLeft||c.scrollLeft,g=d.clientTop||c.clientTop||0,h=d.clientLeft||c.clientLeft||0,i=b.top+e-g,j=b.left+f-h;return{y:Math.round(i),x:Math.round(j),width:a.offsetHeight,height:a.offsetWidth}}else{for(j=i=0;a;)i+=parseInt(a.offsetTop,10),j+=parseInt(a.offsetLeft,10),a=a.offsetParent;return{y:i,
x:j,width:a.offsetHeight,height:a.offsetWidth}}};gantt._detectScrollSize=function(){var a=document.createElement("div");a.style.cssText="visibility:hidden;position:absolute;left:-1000px;width:100px;padding:0px;margin:0px;height:110px;min-height:100px;overflow-y:scroll;";document.body.appendChild(a);var b=a.offsetWidth-a.clientWidth;document.body.removeChild(a);return b};dhtmlxEventable(gantt);gantt._click={};gantt._dbl_click={};gantt._context_menu={};
gantt._on_click=function(a){var a=a||window.event,b=a.target||a.srcElement,c=gantt.locate(a),d=gantt._find_ev_handler(a,b,gantt._click,c);if(d)if(c!==null){var e=!gantt.checkEvent("onTaskClick")||gantt.callEvent("onTaskClick",[c,a]);e&&gantt.config.select_task&&gantt.selectTask(c)}else gantt.callEvent("onEmptyClick",[a])};
gantt._on_contextmenu=function(a){var a=a||window.event,b=a.target||a.srcElement,c=gantt.locate(b),d=gantt.locate(b,gantt.config.link_attribute),e=!gantt.checkEvent("onContextMenu")||gantt.callEvent("onContextMenu",[c,d,a]);e||a.preventDefault();return e};gantt._find_ev_handler=function(a,b,c,d){for(var e=!0;b&&b.parentNode;){var f=b.className;if(f)for(var f=f.split(" "),g=0;g<f.length;g++)f[g]&&c[f[g]]&&(e=c[f[g]].call(gantt,a,d,b),e=!(typeof e!="undefined"&&e!==!0));b=b.parentNode}return e};
gantt._on_dblclick=function(a){var a=a||window.event,b=a.target||a.srcElement,c=gantt.locate(a),d=gantt._find_ev_handler(a,b,gantt._dbl_click,c);if(d&&c!==null){var e=!gantt.checkEvent("onTaskDblClick")||gantt.callEvent("onTaskDblClick",[c,a]);e&&gantt.config.details_on_dblclick&&gantt.showLightbox(c)}};gantt._on_mousemove=function(a){if(gantt.checkEvent("onMouseMove")){var b=gantt.locate(a);gantt._last_move_event=a;gantt.callEvent("onMouseMove",[b,a])}};
function dhtmlxDnD(a,b){if(b)this._settings=b;dhtmlxEventable(this);dhtmlxEvent(a,"mousedown",dhtmlx.bind(function(b){this.dragStart(a,b)},this))}
dhtmlxDnD.prototype={dragStart:function(a,b){this.config={obj:a,marker:null,started:!1,pos:this.getPosition(b),sensitivity:4};this._settings&&dhtmlx.mixin(this.config,this._settings,!0);var c=dhtmlx.bind(function(b){return this.dragMove(a,b)},this),d=dhtmlx.bind(function(b){return this.dragScroll(a,b)},this),e=dhtmlx.bind(function(a){return dhtmlx.defined(this.config.updates_per_second)&&!gantt._checkTimeout(this,this.config.updates_per_second)?!0:c(a)},this),f=dhtmlx.bind(function(){dhtmlxDetachEvent(document.body,
"mousemove",e);dhtmlxDetachEvent(document.body,"mouseup",f);return this.dragEnd(a)},this);dhtmlxEvent(document.body,"mousemove",e);dhtmlxEvent(document.body,"mouseup",f);document.body.className+=" gantt_noselect"},dragMove:function(a,b){if(!this.config.marker&&!this.config.started){var c=this.getPosition(b),d=c.x-this.config.pos.x,e=c.y-this.config.pos.y,f=Math.sqrt(Math.pow(Math.abs(d),2)+Math.pow(Math.abs(e),2));if(f>this.config.sensitivity){this.config.started=!0;this.config.ignore=!1;if(this.callEvent("onBeforeDragStart",
[a,b])===!1)return this.config.ignore=!0;var g=this.config.marker=document.createElement("div");g.className="gantt_drag_marker";g.innerHTML="Dragging object";document.body.appendChild(g);this.callEvent("onAfterDragStart",[a,b])}else this.config.ignore=!0}if(!this.config.ignore)b.pos=this.getPosition(b),this.config.marker.style.left=b.pos.x+"px",this.config.marker.style.top=b.pos.y+"px",this.callEvent("onDragMove",[a,b])},dragEnd:function(){if(this.config.marker)this.config.marker.parentNode.removeChild(this.config.marker),
this.config.marker=null,this.callEvent("onDragEnd",[]);document.body.className=document.body.className.replace(" gantt_noselect","")},getPosition:function(a){var b=0,c=0,a=a||window.event;if(a.pageX||a.pageY)b=a.pageX,c=a.pageY;else if(a.clientX||a.clientY)b=a.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,c=a.clientY+document.body.scrollTop+document.documentElement.scrollTop;return{x:b,y:c}}};
gantt._init_grid=function(){this._click.gantt_close=dhtmlx.bind(function(a,b){this.close(b)},this);this._click.gantt_open=dhtmlx.bind(function(a,b){this.open(b)},this);this._click.gantt_row=dhtmlx.bind(function(a,b,c){if(b!==null){var d=this.getTaskNode(b),e=Math.max(d.offsetLeft-this.config.task_scroll_offset,0);this._scroll_task_area(e);this.callEvent("onTaskRowClick",[b,c])}},this);this._click.gantt_grid_head_cell=dhtmlx.bind(function(a,b,c){var d=c.getAttribute("column_id");if(this.callEvent("onGridHeaderClick",
[d,a]))if(d=="add")this._click.gantt_add(a,0);else if(this.config.sort){var e=this._sort&&this._sort.direction&&this._sort.name==d?this._sort.direction:"desc",e=e=="desc"?"asc":"desc";this._sort={name:d,direction:e};this._render_grid_header();this.sort(d,e=="desc")}},this);!this.config.sort&&this.config.order_branch&&this._init_dnd();this._click.gantt_add=dhtmlx.bind(function(a,b){if(!this.config.readonly){var c=b?this.getTask(b):!1,d="";if(c)d=c.start_date;else var e=this._order[0],d=e?this.getTask(e).start_date:
this.getState().min_date;if(c)c.$open=!0;var f={text:gantt.locale.labels.new_task,start_date:this.templates.xml_format(d),duration:1,progress:0,parent:b};this.callEvent("onTaskCreated",[f]);this.addTask(f);this.showTask(f.id);this.config.details_on_create&&this.showLightbox(f.id)}},this)};gantt._render_grid=function(){this._is_grid_visible()&&(this._calc_grid_width(),this._render_grid_header())};
gantt._calc_grid_width=function(){if(this.config.autofit){for(var a=this.config.columns,b=0,c=[],d=[],e=0;e<a.length;e++){var f=parseInt(a[e].width,10);window.isNaN(f)&&(f=50,c.push(e));d[e]=f;b+=f}var g=this.config.grid_width-b,h=g/(c.length>0?c.length:d.length>0?d.length:1);if(c.length>0)for(var i=g/(c.length?c.length:1),e=0;e<c.length;e++){var j=c[e];d[j]+=i}else{i=g/(d.length?d.length:1);for(e=0;e<d.length;e++)d[e]+=i}for(e=0;e<d.length;e++)a[e].width=d[e]}};
gantt._render_grid_header=function(){for(var a=this.config.columns,b=[],c=0,d=this.locale.labels,e=this.config.scale_height-2,f=0;f<a.length;f++){var g=f==a.length-1,h=a[f];if(g&&this.config.grid_width>c+h.width)h.width=this.config.grid_width-c;c+=h.width;var i=this._sort&&h.name==this._sort.name?"<div class='gantt_sort gantt_"+this._sort.direction+"'></div>":"",j="gantt_grid_head_cell gantt_grid_head_"+h.name+(g?" gantt_last_cell":"")+this.templates.grid_header_class(h.name,h),k="width:"+(h.width-
(g?1:0))+"px;",n=h.label||d["column_"+h.name],n=n||"",l="<div class='"+j+"' style='"+k+"' column_id='"+h.name+"'>"+n+i+"</div>";b.push(l)}this.$grid_scale.style.height=this.config.scale_height-1+"px";this.$grid_scale.style.lineHeight=e+"px";this.$grid_scale.style.width=c-1+"px";this.$grid_scale.innerHTML=b.join("")};
gantt._render_grid_item=function(a){if(!gantt._is_grid_visible())return null;for(var b=this.config.columns,c=[],d=0,e=0;e<b.length;e++){var f=e==b.length-1,g=b[e],h,i;g.name=="add"&&e==b.length-1?i="<div class='gantt_add'></div>":(i=g.template?g.template(a):a[g.name],i instanceof Date&&(i=this.templates.date_grid(i)),i="<div class='gantt_tree_content'>"+i+"</div>");var j="gantt_cell"+(f?" gantt_last_cell":""),k="";if(g.tree){for(var n=0;n<a.$level;n++)k+=this.templates.grid_indent(a);var l=this._branches[a.id]&&
this._branches[a.id].length>0;l?(k+=this.templates.grid_open(a),k+=this.templates.grid_folder(a)):(k+=this.templates.grid_blank(a),k+=this.templates.grid_file(a))}var m="width:"+(g.width-(f?1:0))+"px;";dhtmlx.defined(g.align)&&(m+="text-align:"+g.align+";");h="<div class='"+j+"' style='"+m+"'>"+k+i+"</div>";c.push(h)}j=a.$index%2===0?"":" odd";j+=a.$transparent?" gantt_transparent":"";if(this.templates.grid_row_class){var o=this.templates.grid_row_class.call(this,a.start_date,a.end_date,a);o&&(j+=
" "+o)}this.getState().selected_task==a.id&&(j+=" gantt_selected");var p=document.createElement("div");p.className="gantt_row"+j;p.style.height=this.config.row_height+"px";p.style.lineHeight=gantt.config.row_height+"px";p.setAttribute(this.config.task_attribute,a.id);p.innerHTML=c.join("");return p};gantt.open=function(a){gantt._set_item_state(a,!0);this.callEvent("onTaskOpened",[a])};gantt.close=function(a){gantt._set_item_state(a,!1);this.callEvent("onTaskClosed",[a])};
gantt._set_item_state=function(a,b){if(a&&this._pull[a])this._pull[a].$open=b,this.refreshData()};gantt._is_grid_visible=function(){return this.config.grid_width!=0};gantt.getTaskIndex=function(a){for(var b=this._branches[this.getTask(a).parent],c=0;c<b.length;c++)if(b[c]==a)return c;return-1};gantt.getGlobalTaskIndex=function(a){for(var b=this._order,c=0;c<b.length;c++)if(b[c]==a)return c;return-1};
gantt.moveTask=function(a,b,c,d){var e=d;if(e){if(e===a)return;c=this.getTask(e).parent;b=this.getTaskIndex(e)}var c=c||0,f=this.getTask(a),g=this._branches[f.parent],h=this._branches[c];b==-1&&(b=h.length+1);if(f.parent==c){var i=this.getTaskIndex(a);if(i==b)return;i<b&&b--}this._branch_update(f.parent,a);var h=this._branches[c],j=h[b];j?h=h.slice(0,b).concat([a]).concat(h.slice(b)):h.push(a);f.parent=c;this._branches[c]=h;this.refreshData()};
gantt._init_dnd=function(){var a=new dhtmlxDnD(this.$grid_data,{updates_per_second:60});if(dhtmlx.defined(this.config.dnd_sensitivity))a.config.sensitivity=this.config.dnd_sensitivity;a.attachEvent("onBeforeDragStart",dhtmlx.bind(function(a,c){var d=this._locateHTML(c);if(!d)return!1;this.hideQuickInfo&&this._hideQuickInfo()},this));a.attachEvent("onAfterDragStart",dhtmlx.bind(function(b,c){var d=this._locateHTML(c);a.config.marker.innerHTML=d.outerHTML;a.config.id=this.locate(c);var e=this.getTask(a.config.id);
e.$open=!1;e.$transparent=!0;this.refreshData()},this));a.attachEvent("onDragMove",dhtmlx.bind(function(b,c){var d=a.config,e=this._get_position(this.$grid_data),f=e.x+10,g=c.pos.y-10;if(g<e.y)g=e.y;g>e.y+this.$grid_data.offsetHeight-this.config.row_height&&(g=e.y+this.$grid_data.offsetHeight-this.config.row_height);d.marker.style.left=f+"px";d.marker.style.top=g+"px";var h=document.elementFromPoint(e.x-document.body.scrollLeft+1,g-document.body.scrollTop),i=this.locate(h);if(this.isTaskExists(i)){var j=
gantt._get_position(h),k=this.getTask(i),n=this.getTask(a.config.id);if(j.y+h.offsetHeight/2<g){var l=this.getGlobalTaskIndex(k.id),m=this._pull[this._order[l+1+(k.id==n.id?1:0)]];if(m)if(m.id!=n.id)k=m;else return;else if(m=this._pull[this._order[l+1]],m.$level==n.$level){this.moveTask(n.id,-1,m.parent);d.target="next:"+m.id;return}}if(k.$level==n.$level&&n.id!=k.id)this.moveTask(n.id,0,0,k.id),d.target=k.id;else{if(n.id==k.id)return;var l=this.getGlobalTaskIndex(k.id),o=this._pull[this._order[l-
1]];if(o&&o.$level==n.$level&&n.id!=o.id)this.moveTask(n.id,-1,o.parent),d.target="next:"+o.id}}return!0},this));a.attachEvent("onDragEnd",dhtmlx.bind(function(){this.getTask(a.config.id).$transparent=!1;this.refreshData();this.callEvent("onRowDragEnd",[a.config.id,a.config.target])},this))};
gantt._scale_helpers={getSum:function(a,b,c){c===void 0&&(c=a.length-1);b===void 0&&(b=0);for(var d=0,e=b;e<=c;e++)d+=a[e];return d},setSumWidth:function(a,b,c,d){var e=b.width;d===void 0&&(d=e.length-1);c===void 0&&(c=0);var f=d-c+1;if(!(c>e.length-1||f<=0||d>e.length-1||!a)){var g=this.getSum(e,c,d),h=a-g;this.adjustSize(h,e,c,d);this.adjustSize(-h,e,d+1);b.full_width=this.getSum(e)}},splitSize:function(a,b){for(var c=[],d=0;d<b;d++)c[d]=0;this.adjustSize(a,c);return c},adjustSize:function(a,b,
c,d){c||(c=0);d===void 0&&(d=b.length-1);for(var e=d-c+1,f=this.getSum(b,c,d),g=0,h=c;h<=d;h++){var i=Math.floor(a*(f?b[h]/f:1/e));b[h]+=i;g+=i}b[b.length-1]+=a-g},sortScales:function(a){function b(a,b){var e=new Date(1970,0,1);return gantt.date.add(e,b,a)-e}a.sort(function(a,d){return b(a.unit,a.step)<b(d.unit,d.step)?1:-1})},primaryScale:function(){gantt._init_template("date_scale");return{unit:gantt.config.scale_unit,step:gantt.config.step,template:gantt.templates.date_scale,date:gantt.config.date_scale,
css:gantt.templates.scale_cell_class}},prepareConfigs:function(a,b,c,d){for(var e=this.prepareScaleConfig(a[a.length-1],b,c).full_width,f=this.splitSize(d,a.length),g=[],h=0;h<a.length;h++){var i=this.prepareScaleConfig(a[h],b,e,f[h]);this.formatScales(i);g.push(i)}for(h=0;h<g.length-1;h++)this.alineScaleColumns(g[g.length-1],g[h]);return g},prepareScaleConfig:function(a,b,c,d){var e=dhtmlx.mixin({count:0,col_width:0,full_width:0,height:d,width:[],trace_x:[]},a);this.eachColumn(a.unit,a.step,function(a){e.count++;
e.trace_x.push(new Date(a))});var f=c;e.col_width=Math.floor(f/e.count);if(b&&e.col_width<b)e.col_width=b,f=e.col_width*e.count;e.width=this.splitSize(f,e.count);e.full_width=this.getSum(e.width);return e},alineScaleColumns:function(a,b,c,d){for(var e=b.trace_x,f=a.trace_x,g=c||0,h=d||f.length-1,i=0,j=1;j<e.length;j++)for(var k=g;k<=h;k++)if(+f[k]==+e[j]){var n=this.getSum(a.width,g,k-1),l=this.getSum(b.width,i,j-1);l!=n&&this.setSumWidth(n,b,i,j-1);g=k;i=j}},eachColumn:function(a,b,c){var d=new Date(gantt._min_date),
e=new Date(gantt._max_date);gantt.date[a+"_start"]&&(d=gantt.date[a+"_start"](d));for(var f=new Date(d);+f<+e;)c.call(this,new Date(f)),f=gantt.date.add(f,b,a)},formatScales:function(a){var b=a.trace_x,c=-1,d=0,e=a.width.length-1,f=0;if(+b[0]<+gantt._min_date&&d!=e){var g=Math.floor(a.width[0]*((b[1]-gantt._min_date)/(b[1]-b[0])));f+=a.width[0]-g;a.width[0]=g;b[0]=new Date(gantt._min_date)}var h=b.length-1,i=b[h],j=gantt.date.add(i,a.step,a.unit);+j>+gantt._max_date&&h>0&&(g=a.width[h]-Math.floor(a.width[h]*
((j-gantt._max_date)/(j-i))),f+=a.width[h]-g,a.width[h]=g);if(f){for(var k=this.getSum(a.width),n=0,l=0;l<a.width.length;l++){var m=Math.floor(f*(a.width[l]/k));a.width[l]+=m;n+=m}this.adjustSize(f-n,a.width)}}};
gantt._tasks_dnd={drag:null,_events:{before_start:{},before_finish:{},after_finish:{}},_handlers:{},init:function(){this.clear_drag_state();var a=gantt.config.drag_mode;this.set_actions();var b={before_start:"onBeforeTaskDrag",before_finish:"onBeforeTaskChanged",after_finish:"onAfterTaskDrag"},c;for(c in this._events)for(var d in a)this._events[c][d]=b[c];this._handlers[a.move]=this._move;this._handlers[a.resize]=this._resize;this._handlers[a.progress]=this._resize_progress},set_actions:function(){var a=
gantt.$task_data;dhtmlxEvent(a,"mousemove",dhtmlx.bind(function(a){this.on_mouse_move(a||event)},this));dhtmlxEvent(a,"mousedown",dhtmlx.bind(function(a){this.on_mouse_down(a||event)},this));dhtmlxEvent(a,"mouseup",dhtmlx.bind(function(a){this.on_mouse_up(a||event)},this))},clear_drag_state:function(){this.drag={id:null,mode:null,pos:null,start:null,obj:null,left:null}},_drag_timeout:function(){if(this._cancel_drag)return!1;setTimeout(dhtmlx.bind(function(){this._cancel_drag=!1},this),25);return this._cancel_drag=
!0},_resize:function(a,b,c){var d=gantt.config;c.left?a.start_date=new Date(c.start.valueOf()+b):a.end_date=new Date(c.start.valueOf()+b);if(a.end_date-a.start_date<d.min_duration)c.left?a.start_date=new Date(a.end_date.valueOf()-d.min_duration):a.end_date=new Date(a.start_date.valueOf()+d.min_duration);gantt._init_task_timing(a)},_resize_progress:function(a,b,c){var d=c.obj_s_x=c.obj_s_x||gantt.posFromDate(a.start_date),e=c.obj_e_x=c.obj_e_x||gantt.posFromDate(a.end_date),f=Math.max(0,c.pos.x-d);
a.progress=Math.min(1,f/(e-d))},_move:function(a,b,c){a.start_date=new Date(c.obj.start_date.valueOf()+b);a.end_date=new Date(c.obj.end_date.valueOf()+b)},on_mouse_move:function(a){this.drag.start_drag&&this._start_dnd(a);var b=this.drag;b.mode&&gantt._checkTimeout(this,40)&&this._update_on_move(a)},_update_on_move:function(a){var b=this.drag;if(b.mode){var c=gantt._get_mouse_pos(a);if(!(b.pos&&b.pos.x==c.x)){b.pos=c;var d=gantt._date_from_pos(c.x);if(d&&!isNaN(d.getTime())){var e=d-b.start,f=gantt.getTask(b.id);
if(this._handlers[b.mode]){var g=dhtmlx.mixin({},f),h=dhtmlx.mixin({},f);this._handlers[b.mode].apply(this,[h,e,b]);dhtmlx.mixin(f,h,!0);gantt._update_parents(b.id,!0);gantt.callEvent("onTaskDrag",[f.id,b.mode,h,g,a]);dhtmlx.mixin(f,h,!0);gantt._update_parents(b.id);gantt.refreshTask(b.id)}}}}},on_mouse_down:function(a,b){if(a.button!=2&&!gantt.config.readonly&&!this.drag.mode){this.clear_drag_state();var b=b||a.target||a.srcElement,c=gantt._trim(b.className||"");if(!c||!this._get_drag_mode(c))if(b.parentNode)return this.on_mouse_down(a,
b.parentNode);else return;var d=this._get_drag_mode(c);if(d)if(d.mode&&d.mode!=gantt.config.drag_mode.ignore&&gantt.config["drag_"+d.mode]){var e=gantt.locate(b),f=dhtmlx.copy(gantt.getTask(e)||{});if(gantt._is_flex_task(f)&&d.mode!=gantt.config.drag_mode.progress)this.clear_drag_state();else{d.id=e;var g=gantt._get_mouse_pos(a);d.start=gantt._date_from_pos(g.x);d.obj=f;this.drag.start_drag=d}}else this.clear_drag_state();else if(gantt.checkEvent("onMouseDown")&&gantt.callEvent("onMouseDown",[c.split(" ")[0]])&&
b.parentNode)return this.on_mouse_down(a,b.parentNode)}},on_mouse_up:function(a){var b=this.drag;if(b.mode&&b.id){var c=gantt.getTask(b.id);if(this._fireEvent("before_finish",b.mode,[b.id,b.mode,dhtmlx.copy(b.obj),a])){var d=b.id;if(gantt.config.round_dnd_dates){var e=gantt._tasks;gantt._round_task_dates(c,e.step,e.unit)}else gantt._round_task_dates(c,gantt.config.time_step,"minute");gantt._init_task_timing(c);gantt.updateTask(c.id);this._fireEvent("after_finish",b.mode,[d,b.mode,a]);this.clear_drag_state()}else b.obj._dhx_changed=
!1,dhtmlx.mixin(c,b.obj,!0),gantt.updateTask(c.id)}this.clear_drag_state()},_get_drag_mode:function(a){var b=gantt.config.drag_mode,c=(a||"").split(" "),d=c[0],e={mode:null,left:null};switch(d){case "gantt_task_line":case "gantt_task_content":e.mode=b.move;break;case "gantt_task_drag":e.mode=b.resize;e.left=c[1]&&c[1].indexOf("left",c[1].length-4)!==-1?!0:!1;break;case "gantt_task_progress_drag":e.mode=b.progress;break;case "gantt_link_control":case "gantt_link_point":e.mode=b.ignore;break;default:e=
null}return e},_start_dnd:function(a){var b=this.drag=this.drag.start_drag;delete b.start_drag;var c=gantt.config,d=b.id;!c["drag_"+b.mode]||!gantt.callEvent("onBeforeDrag",[d,b.mode,a])||!this._fireEvent("before_start",b.mode,[d,b.mode,a])?this.clear_drag_state():delete b.start_drag},_fireEvent:function(a,b,c){var d=this._events[a][b];return!gantt.checkEvent(d)?!0:gantt.callEvent(d,c)}};gantt._render_link=function(a){var b=this.getLink(a);gantt._linkRenderer.render_item(b,this.$task_links)};
gantt._get_link_type=function(a,b){var c;a&&b?c=gantt.config.links.start_to_start:!a&&b?c=gantt.config.links.finish_to_start:!a&&!b?c=gantt.config.links.finish_to_finish:a&&!b&&(c=null);return c};gantt.isLinkAllowed=function(a,b,c,d){var e=typeof a=="object"?a:{source:a,target:b,type:this._get_link_type(c,d)};if(!e)return!1;if(!e.source||!e.target||!e.type)return!1;if(e.source==e.target)return!1;var f=!0;this.checkEvent("onLinkValidation")&&(f=this.callEvent("onLinkValidation",[e]));return f};
gantt._render_link_element=function(a){if(gantt.isTaskVisible(a.source)&&gantt.isTaskVisible(a.target)){var b=this._path_builder.get_points(a),c=gantt._drawer,d=c.get_lines(b),e=document.createElement("div"),f="gantt_task_link",g=this.templates.link_class?this.templates.link_class(a):"";g&&(f+=" "+g);e.className=f;e.setAttribute(gantt.config.link_attribute,a.id);for(var h=0;h<d.length;h++)h==d.length-1&&(d[h].size-=gantt.config.link_arrow_size),e.appendChild(c.render_line(d[h],d[h+1]));var i=d[d.length-
1].direction,j=gantt._render_link_arrow(b[b.length-1],i);e.appendChild(j);return e}};
gantt._render_link_arrow=function(a,b){var c=document.createElement("div"),d=gantt._drawer,e=a.y,f=a.x,g=gantt.config.link_arrow_size,h=gantt.config.row_height,i="gantt_link_arrow gantt_link_arrow_"+b;switch(b){case d.dirs.right:e-=(g-h)/2;f-=g;break;case d.dirs.left:e-=(g-h)/2;break;case d.dirs.up:f-=(g-h)/2;break;case d.dirs.down:e-=g,f-=(g-h)/2}c.style.cssText=["top:"+e+"px","left:"+f+"px"].join(";");c.className=i;return c};
gantt._drawer={current_pos:null,dirs:{left:"left",right:"right",up:"up",down:"down"},path:[],clear:function(){this.current_pos=null;this.path=[]},point:function(a){this.current_pos=dhtmlx.copy(a)},get_lines:function(a){this.clear();this.point(a[0]);for(var b=1;b<a.length;b++)this.line_to(a[b]);return this.get_path()},line_to:function(a){var b=dhtmlx.copy(a),c=this.current_pos,d=this._get_line(c,b);this.path.push(d);this.current_pos=b},get_path:function(){return this.path},get_wrapper_sizes:function(a){var b,
c=gantt.config.link_wrapper_width,d=gantt.config.link_line_width,e=a.y+(gantt.config.row_height-c)/2;switch(a.direction){case this.dirs.left:b={top:e,height:c,lineHeight:c,left:a.x-a.size-c/2,width:a.size+c};break;case this.dirs.right:b={top:e,lineHeight:c,height:c,left:a.x-c/2,width:a.size+c};break;case this.dirs.up:b={top:e-a.size,lineHeight:a.size+c,height:a.size+c,left:a.x-c/2,width:c};break;case this.dirs.down:b={top:e,lineHeight:a.size+c,height:a.size+c,left:a.x-c/2,width:c}}return b},get_line_sizes:function(a){var b,
c=gantt.config.link_line_width,d=gantt.config.link_wrapper_width,e=a.size+c;switch(a.direction){case this.dirs.left:case this.dirs.right:b={height:c,width:e,marginTop:(d-c)/2,marginLeft:(d-c)/2};break;case this.dirs.up:case this.dirs.down:b={height:e,width:c,marginTop:(d-c)/2,marginLeft:(d-c)/2}}return b},render_line:function(a){var b=this.get_wrapper_sizes(a),c=document.createElement("div");c.style.cssText=["top:"+b.top+"px","left:"+b.left+"px","height:"+b.height+"px","width:"+b.width+"px"].join(";");
c.className="gantt_line_wrapper";var d=this.get_line_sizes(a),e=document.createElement("div");e.style.cssText=["height:"+d.height+"px","width:"+d.width+"px","margin-top:"+d.marginTop+"px","margin-left:"+d.marginLeft+"px"].join(";");e.className="gantt_link_line_"+a.direction;c.appendChild(e);return c},_get_line:function(a,b){var c=this.get_direction(a,b),d={x:a.x,y:a.y,direction:this.get_direction(a,b)};d.size=c==this.dirs.left||c==this.dirs.right?Math.abs(a.x-b.x):Math.abs(a.y-b.y);return d},get_direction:function(a,
b){var c=0;return c=b.x<a.x?this.dirs.left:b.x>a.x?this.dirs.right:b.y>a.y?this.dirs.down:this.dirs.up}};gantt._y_from_ind=function(a){return a*gantt.config.row_height};
gantt._path_builder={path:[],clear:function(){this.path=[]},current:function(){return this.path[this.path.length-1]},point:function(a){if(!a)return this.current();this.path.push(dhtmlx.copy(a));return a},point_to:function(a,b,c){var c=c?{x:c.x,y:c.y}:dhtmlx.copy(this.point()),d=gantt._drawer.dirs;switch(a){case d.left:c.x-=b;break;case d.right:c.x+=b;break;case d.up:c.y-=b;break;case d.down:c.y+=b}return this.point(c)},get_points:function(a){var b=this.get_endpoint(a),c=gantt.config,d=b.e_y-b.y,e=
b.e_x-b.x,f=gantt._drawer.dirs;this.clear();this.point({x:b.x,y:b.y});var g=2*c.link_arrow_size,h=b.e_x>b.x;if(a.type==gantt.config.links.start_to_start)this.point_to(f.left,g),h?(this.point_to(f.down,d),this.point_to(f.right,e)):(this.point_to(f.right,e),this.point_to(f.down,d)),this.point_to(f.right,g);else if(a.type==gantt.config.links.finish_to_start)if(h=b.e_x>b.x+2*g,this.point_to(f.right,g),h)e-=g,this.point_to(f.down,d),this.point_to(f.right,e);else{e-=2*g;var i=d>0?1:-1;this.point_to(f.down,
i*(c.row_height/2));this.point_to(f.right,e);this.point_to(f.down,i*(Math.abs(d)-c.row_height/2));this.point_to(f.right,g)}else a.type==gantt.config.links.finish_to_finish&&(this.point_to(f.right,g),h?(this.point_to(f.right,e),this.point_to(f.down,d)):(this.point_to(f.down,d),this.point_to(f.right,e)),this.point_to(f.left,g));return this.path},get_endpoint:function(a){var b=gantt.config.links,c=!1,d=!1;a.type==b.start_to_start?c=d=!0:a.type==b.finish_to_finish?c=d=!1:a.type==b.finish_to_start&&(c=
!1,d=!0);var e=gantt._get_task_visible_pos(gantt._pull[a.source],c),f=gantt._get_task_visible_pos(gantt._pull[a.target],d);return{x:e.x,e_x:f.x,y:e.y,e_y:f.y}}};
gantt._init_links_dnd=function(){function a(a,b,c){var d=gantt._get_task_pos(a,!!b);d.y+=gantt._get_task_height()/2;c=c||0;d.x+=(b?-1:1)*c;return d}function b(a){var b=d(),c=["gantt_link_tooltip"];b.from&&b.to&&(gantt.isLinkAllowed(b.from,b.to,b.from_start,b.to_start)?c.push("gantt_allowed_link"):c.push("gantt_invalid_link"));var e=gantt.templates.drag_link_class(b.from,b.from_start,b.to,b.to_start);e&&c.push(e);var f="<div class='"+e+"'>"+gantt.templates.drag_link(b.from,b.from_start,b.to,b.to_start)+
"</div>";a.innerHTML=f}function c(a,b){a.style.left=b.x+5+"px";a.style.top=b.y+5+"px"}function d(){return{from:gantt._link_source_task,to:gantt._link_target_task,from_start:gantt._link_source_task_start,to_start:gantt._link_target_task_start}}function e(){gantt._link_source_task=gantt._link_source_task_start=gantt._link_target_task=gantt._link_target_task_start=null}function f(a,b,c,e){var f=i(),k=d(),j=["gantt_link_direction"];gantt.templates.link_direction_class&&j.push(gantt.templates.link_direction_class(k.from,
k.from_start,k.to,k.to_start));var n=Math.sqrt(Math.pow(c-a,2)+Math.pow(e-b,2));if(n=Math.max(0,n-3)){f.className=j.join(" ");var m=(e-b)/(c-a),l=Math.atan(m);h(a,c,b,e)==2?l+=Math.PI:h(a,c,b,e)==3&&(l-=Math.PI);var x=Math.sin(l),t=Math.cos(l),r=Math.round(b),s=Math.round(a),u=["-webkit-transform: rotate("+l+"rad)","-moz-transform: rotate("+l+"rad)","-ms-transform: rotate("+l+"rad)","-o-transform: rotate("+l+"rad)","transform: rotate("+l+"rad)","width:"+Math.round(n)+"px"];if(window.navigator.userAgent.indexOf("MSIE 8.0")!=
-1){u.push('-ms-filter: "'+g(x,t)+'"');var y=Math.abs(Math.round(a-c)),z=Math.abs(Math.round(e-b));switch(h(a,c,b,e)){case 1:r-=z;break;case 2:s-=y;r-=z;break;case 3:s-=y}}u.push("top:"+r+"px");u.push("left:"+s+"px");f.style.cssText=u.join(";")}}function g(a,b){return"progid:DXImageTransform.Microsoft.Matrix(M11 = "+b+",M12 = -"+a+",M21 = "+a+",M22 = "+b+",SizingMethod = 'auto expand')"}function h(a,b,c,d){return b>=a?d<=c?1:4:d<=c?2:3}function i(){if(!k._direction)k._direction=document.createElement("div"),
gantt.$task_links.appendChild(k._direction);return k._direction}function j(){if(k._direction)k._direction.parentNode&&k._direction.parentNode.removeChild(k._direction),k._direction=null}var k=new dhtmlxDnD(this.$task_bars,{sensitivity:0,updates_per_second:60}),n="task_left",l="gantt_link_point",m="gantt_link_control";k.attachEvent("onBeforeDragStart",dhtmlx.bind(function(b,c){if(gantt.config.readonly)return!1;var d=c.target||c.srcElement;e();if(gantt.getState().drag_id)return!1;if(gantt._locate_css(d,
l)){if(gantt._locate_css(d,n))gantt._link_source_task_start=!0;var f=gantt._link_source_task=this.locate(c),g=gantt.getTask(f),h=g.type==gantt.config.types.milestone?(gantt._get_visible_milestone_width()-gantt._get_milestone_width())/2:0;this._dir_start=a(g,!!gantt._link_source_task_start,h);return!0}else return!1},this));k.attachEvent("onAfterDragStart",dhtmlx.bind(function(){b(k.config.marker)},this));k.attachEvent("onDragMove",dhtmlx.bind(function(d,e){var g=k.config,h=k.getPosition(e);c(g.marker,
h);var i=gantt._is_link_drop_area(e),j=gantt._link_target_task,l=gantt._link_landing,C=gantt._link_target_task_start,q=gantt.locate(e);if(i)var w=!1,w=!!gantt._locate_css(e,n),i=!!q;gantt._link_target_task=q;gantt._link_landing=i;gantt._link_target_task_start=w;if(i){var x=gantt.getTask(q),t=gantt._locate_css(e,m),r=0;t&&(r=Math.floor(t.offsetWidth/2));this._dir_end=a(x,!!gantt._link_target_task_start,r)}else this._dir_end=gantt._get_mouse_pos(e);var s=!(l==i&&j==q&&C==w);s&&(j&&gantt.refreshTask(j,
!1),q&&gantt.refreshTask(q,!1));s&&b(g.marker);f(this._dir_start.x,this._dir_start.y,this._dir_end.x,this._dir_end.y);return!0},this));k.attachEvent("onDragEnd",dhtmlx.bind(function(){var a=d();if(a.from&&a.to&&a.from!=a.to){var b=gantt._get_link_type(a.from_start,a.to_start);b&&gantt.addLink({source:a.from,target:a.to,type:b})}e();a.from&&gantt.refreshTask(a.from,!1);a.to&&gantt.refreshTask(a.to,!1);j()},this));gantt._is_link_drop_area=function(a){return!!gantt._locate_css(a,m)}};
gantt._get_link_state=function(){return{link_landing_area:this._link_landing,link_target_id:this._link_target_task,link_target_start:this._link_target_task_start,link_source_id:this._link_source_task,link_source_start:this._link_source_task_start}};
gantt._init_tasks=function(){function a(a,c,d,e){for(var f=0;f<a.length;f++)a[f].change_id(c,d),a[f].render_item(e)}this._tasks={col_width:this.config.columnWidth,width:[],full_width:0,trace_x:[],rendered:{}};this._click.gantt_task_link=dhtmlx.bind(function(a){var c=this.locate(a,gantt.config.link_attribute);c&&this.callEvent("onLinkClick",[c,a])},this);this._dbl_click.gantt_task_link=dhtmlx.bind(function(a,c){c=this.locate(a,gantt.config.link_attribute);this._delete_link_handler(c,a)},this);this._dbl_click.gantt_link_point=
dhtmlx.bind(function(a,c,d){var c=this.locate(a),e=this.getTask(c),f=null;d.parentNode&&d.parentNode.className&&(f=d.parentNode.className.indexOf("_left")>-1?e.$target[0]:e.$source[0]);f&&this._delete_link_handler(f,a);return!1},this);this._tasks_dnd.init();this._init_links_dnd();this._taskRenderer=gantt._task_renderer("line",this._render_task_element,this.$task_bars);this._linkRenderer=gantt._task_renderer("links",this._render_link_element,this.$task_links);this._gridRenderer=gantt._task_renderer("grid_items",
this._render_grid_item,this.$grid_data);this._bgRenderer=gantt._task_renderer("bg_lines",this._render_bg_line,this.$task_bg);this.attachEvent("onTaskIdChange",function(b,c){var d=this._get_task_renderers();a(d,b,c,this.getTask(c))});this.attachEvent("onLinkIdChange",function(b,c){var d=this._get_link_renderers();a(d,b,c,this.getLink(c))})};gantt._get_task_renderers=function(){return[this._taskRenderer,this._gridRenderer,this._bgRenderer]};gantt._get_link_renderers=function(){return[this._linkRenderer]};
gantt._delete_link_handler=function(a,b){if(a&&this.callEvent("onLinkDblClick",[a,b])&&!this.config.readonly){var c="",d=gantt.locale.labels.link+" "+this.templates.link_description(this.getLink(a))+" "+gantt.locale.labels.confirm_link_deleting;window.setTimeout(function(){gantt._dhtmlx_confirm(d,c,function(){gantt.deleteLink(a)})},gantt.config.touch?300:1)}};gantt.getTaskNode=function(a){return this._taskRenderer.rendered[a]};gantt.getLinkNode=function(a){return this._linkRenderer.rendered[a]};
gantt._get_tasks_data=function(){for(var a=[],b=0;b<this._order.length;b++){var c=this._pull[this._order[b]];c.$index=b;this._update_parents(c.id,!0);a.push(c)}return a};gantt._get_links_data=function(){var a=[],b;for(b in this._lpull)a.push(this._lpull[b]);return a};gantt._render_data=function(){this._update_layout_sizes();for(var a=this._get_tasks_data(),b=this._get_task_renderers(),c=0;c<b.length;c++)b[c].render_items(a);for(var d=gantt._get_links_data(),b=this._get_link_renderers(),c=0;c<b.length;c++)b[c].render_items(d)};
gantt._update_layout_sizes=function(){var a=this._tasks;a.bar_height=this._get_task_height();this.$task_data.style.height=Math.max(this.$task.offsetHeight-this.config.scale_height,0)+"px";this.$task_bg.style.width=a.full_width+"px";if(this._is_grid_visible()){for(var b=this.config.columns,c=0,d=0;d<b.length;d++)c+=b[d].width;this.$grid_data.style.width=Math.max(c-1,0)+"px"}};
gantt._init_tasks_range=function(){var a=this.config.scale_unit;if(this.config.start_date&&this.config.end_date)this._min_date=this.date[a+"_start"](new Date(this.config.start_date)),this._max_date=this.date[a+"_start"](new Date(this.config.end_date));else{var b=this._get_tasks_data(),c=this._init_task({id:0});b.push(c);var d=-Infinity,e=Infinity;this.eachTask(function(a){a.end_date&&+a.end_date>+d&&(d=new Date(a.end_date))},"0");this.eachTask(function(a){a.start_date&&+a.start_date<+e&&(e=new Date(a.start_date))},
"0");this._min_date=e;this._max_date=d;if(!d||d==-Infinity)this._min_date=new Date,this._max_date=new Date(this._min_date);this._min_date=this.date[a+"_start"](this._min_date);if(+this._min_date==+e)this._min_date=this.date.add(this.date[a+"_start"](this._min_date),-1,a);this._max_date=this.date[a+"_start"](this._max_date);this._max_date=this.date.add(this._max_date,1,a)}};
gantt._prepare_scale_html=function(a){var b=[],c=null,d=null,e=null;if(a.template||a.date)d=a.template||this.date.date_to_str(a.date);for(var e=a.css||gantt.templates.scale_cell_class,f=0;f<a.count;f++){var c=new Date(a.trace_x[f]),g=d.call(this,c),h=a.width[f],i="width:"+h+"px;",j="gantt_scale_cell"+(f==a.count-1?" gantt_last_cell":""),k=e.call(this,c);k&&(j+=" "+k);var n="<div class='"+j+"' style='"+i+"'>"+g+"</div>";b.push(n)}return b.join("")};
gantt._render_tasks_scales=function(){this._init_tasks_range();this._scroll_resize();this._set_sizes();var a=this._scale_helpers,b=[a.primaryScale()].concat(this.config.subscales);a.sortScales(b);for(var c=a.prepareConfigs(b,this.config.min_column_width,this.$task.offsetWidth,this.config.scale_height-1),d=this._tasks=c[c.length-1],e=[],f=this.templates.scale_row_class,g=0;g<c.length;g++){var h="gantt_scale_line",i=f(c[g]);i&&(h+=" "+i);e.push('<div class="'+h+'" style="height:'+c[g].height+"px;line-height:"+
c[g].height+'px">'+this._prepare_scale_html(c[g])+"</div>")}this.$task_scale.style.height=this.config.scale_height-1+"px";this.$task_data.style.width=this.$task_scale.style.width=d.full_width+this.$scroll_ver.offsetWidth+"px";this.$task_links.style.width=this.$task_bars.style.width=d.full_width+"px";b=e.join("");this.$task_scale.innerHTML=b};
gantt._render_bg_line=function(a){for(var b=gantt._tasks,c=b.count,d=[],e=0;e<c;e++){var f=b.width[e],g="width:"+f+"px;",h="gantt_task_cell"+(e==c-1?" gantt_last_cell":"");(k=this.templates.task_cell_class(a,b.trace_x[e]))&&(h+=" "+k);var i="<div class='"+h+"' style='"+g+"'></div>";d.push(i)}var j=a.$index%2!==0,k=gantt.templates.task_row_class(a.start_date,a.end_date,a),n="gantt_task_row"+(j?" odd":"")+(k?" "+k:"");this.getState().selected_task==a.id&&(n+=" gantt_selected");var l=document.createElement("div");
l.className=n;l.style.height=gantt.config.row_height+"px";l.setAttribute(this.config.task_attribute,a.id);l.innerHTML=d.join("");return l};gantt._adjust_scales=function(){if(this.config.fit_tasks){var a=+this._min_date,b=+this._max_date;this._init_tasks_range();if(+this._min_date!=a||+this._max_date!=b)return this.render(),this.callEvent("onScaleAdjusted",[]),!0}return!1};
gantt.refreshTask=function(a,b){var c=this._get_task_renderers(),d=this.getTask(a);if(d&&this.isTaskVisible(a))for(var e=0;e<c.length;e++)c[e].render_item(d);else for(e=0;e<c.length;e++)c[e].remove_item(a);if(b===void 0||b){d=this.getTask(a);for(e=0;e<d.$source.length;e++)gantt.refreshLink(d.$source[e]);for(e=0;e<d.$target.length;e++)gantt.refreshLink(d.$target[e])}};gantt.refreshLink=function(a){this.isLinkExists(a)?gantt._render_link(a):gantt._linkRenderer.remove_item(a)};
gantt._combine_item_class=function(a,b,c){var d=[a];b&&d.push(b);var e=gantt.getState(),f=this.getTask(c);this.getTaskType(f.type)==this.config.types.milestone&&d.push("gantt_milestone");this.getTaskType(f.type)==this.config.types.project&&d.push("gantt_project");this._is_flex_task(f)&&d.push("gantt_dependent_task");this.config.select_task&&c==e.selected_task&&d.push("gantt_selected");c==e.drag_id&&d.push("gantt_drag_"+e.drag_mode);var g=gantt._get_link_state();g.link_source_id==c&&d.push("gantt_link_source");
g.link_target_id==c&&d.push("gantt_link_target");if(g.link_landing_area&&g.link_target_id&&g.link_source_id&&g.link_target_id!=g.link_source_id){var h=g.link_source_id,i=g.link_source_start,j=g.link_target_start,k=gantt.isLinkAllowed(h,c,i,j),n="",n=k?j?"link_start_allow":"link_finish_allow":j?"link_start_deny":"link_finish_deny";d.push(n)}return d.join(" ")};
gantt._render_pair=function(a,b,c,d){var e=gantt.getState();+c.end_date<=+e.max_date&&a.appendChild(d(b+" task_right"));+c.start_date>=+e.min_date&&a.appendChild(d(b+" task_left"))};gantt._get_task_height=function(){var a=this.config.task_height;a=="full"&&(a=this.config.row_height-5);a=Math.min(a,this.config.row_height);return Math.max(a,0)};gantt._get_milestone_width=function(){return this._get_task_height()};
gantt._get_visible_milestone_width=function(){var a=gantt._get_task_height();return Math.sqrt(2*a*a)};gantt._get_task_width=function(a){return Math.round(this._get_task_pos(a,!1).x-this._get_task_pos(a,!0).x)};
gantt._render_task_element=function(a){if(!(+a.start_date<+this._max_date&&+a.end_date>+this._min_date))return!1;var b=this._get_task_pos(a),c=this.config,d=this._get_task_height(),e=Math.floor((this.config.row_height-d)/2);a.type==c.types.milestone&&c.link_line_width>1&&(e+=1);var f=document.createElement("div"),g=gantt._get_task_width(a),h=this.getTaskType(a.type);f.setAttribute(this.config.task_attribute,a.id);f.appendChild(gantt._render_task_content(a,g));f.className=this._combine_item_class("gantt_task_line",
this.templates.task_class(a.start_date,a.end_date,a),a.id);f.style.cssText=["left:"+b.x+"px","top:"+(e+b.y)+"px","height:"+d+"px","line-height:"+d+"px","width:"+g+"px"].join(";");var i=this._render_leftside_content(a);i&&f.appendChild(i);(i=this._render_rightside_content(a))&&f.appendChild(i);c.show_progress&&h!=this.config.types.milestone&&this._render_task_progress(a,f,g);this.config.readonly||(c.drag_resize&&!this._is_flex_task(a)&&h!=this.config.types.milestone&&gantt._render_pair(f,"gantt_task_drag",
a,function(a){var b=document.createElement("div");b.className=a;return b}),c.drag_links&&gantt._render_pair(f,"gantt_link_control",a,function(a){var b=document.createElement("div");b.className=a;b.style.cssText=["height:"+d+"px","line-height:"+d+"px"].join(";");var c=document.createElement("div");c.className="gantt_link_point";b.appendChild(c);return b}));return f};
gantt._render_side_content=function(a,b,c){if(!b)return null;var d=b(a.start_date,a.end_date,a);if(!d)return null;var e=document.createElement("div");e.className="gantt_side_content "+c;e.innerHTML=d;return e};gantt._render_leftside_content=function(a){var b="gantt_left "+gantt._get_link_crossing_css(!0,a);return gantt._render_side_content(a,this.templates.leftside_text,b)};
gantt._render_rightside_content=function(a){var b="gantt_right "+gantt._get_link_crossing_css(!1,a);return gantt._render_side_content(a,this.templates.rightside_text,b)};gantt._get_conditions=function(a){return a?{$source:[gantt.config.links.start_to_start],$target:[gantt.config.links.start_to_start,gantt.config.links.finish_to_start]}:{$source:[gantt.config.links.finish_to_start,gantt.config.links.finish_to_finish],$target:[gantt.config.links.finish_to_finish]}};
gantt._get_link_crossing_css=function(a,b){var c=gantt._get_conditions(a),d;for(d in c)for(var e=b[d],f=0;f<e.length;f++)for(var g=gantt.getLink(e[f]),h=0;h<c[d].length;h++)if(g.type==c[d][h])return"gantt_link_crossing";return""};gantt._render_task_content=function(a){var b=document.createElement("div");if(this.getTaskType(a.type)!=this.config.types.milestone)b.innerHTML=this.templates.task_text(a.start_date,a.end_date,a);b.className="gantt_task_content";return b};
gantt._render_task_progress=function(a,b,c){var d=a.progress*1||0,c=Math.max(c-2,0),e=document.createElement("div"),f=Math.round(c*d);e.style.width=f+"px";e.className="gantt_task_progress";e.innerHTML=this.templates.progress_text(a.start_date,a.end_date,a);b.appendChild(e);if(this.config.drag_progress&&!gantt.config.readonly){var g=document.createElement("div");g.style.left=f+"px";g.className="gantt_task_progress_drag";e.appendChild(g);b.appendChild(g)}};
gantt._get_line=function(a){var b={second:1,minute:60,hour:3600,day:86400,week:604800,month:2592E3,year:31536E3};return b[a]||0};gantt._date_from_pos=function(a){var b=this._tasks;if(a<0||a>b.full_width)return null;for(var c=0,d=0;d+b.width[c]<a;)c++,d+=b.width[c];var e=(a-d)/b.width[c],f=gantt._get_coll_duration(b,b.trace_x[c]),g=new Date(b.trace_x[c].valueOf()+Math.round(e*f));return g};
gantt.posFromDate=function(a){for(var b=gantt._day_index_by_date(a),c=Math.floor(b),d=b%1,e=0,f=1;f<=c;f++)e+=gantt._tasks.width[f-1];d&&(e+=c<gantt._tasks.width.length?gantt._tasks.width[c]*(d%1):1);return e};gantt._day_index_by_date=function(a){var b=new Date(a),c=gantt._tasks.trace_x;if(+b<=this._min_date)return 0;if(+b>=this._max_date)return c.length;for(var d=0;d<c.length-1;d++)if(+b<c[d+1])break;return d+(a-c[d])/gantt._get_coll_duration(gantt._tasks,c[d])};
gantt._get_coll_duration=function(a,b){return gantt.date.add(b,a.step,a.unit)-b};gantt._get_x_pos=function(a,b){var b=b!==!1,c=gantt.posFromDate(b?a.start_date:a.end_date)};gantt._get_task_coord=function(a,b,c){var b=b!==!1,c=c||0,d=a.type==this.config.types.milestone,e=this.posFromDate(b||d?a.start_date:a.end_date),f=this._y_from_ind(this._get_visible_order(a.id));d&&(b?e-=c:e+=c);return{x:e,y:f}};
gantt._get_task_pos=function(a,b){var b=b!==!1,c=gantt._get_milestone_width()/2;return this._get_task_coord(a,b,c)};gantt._get_task_visible_pos=function(a,b){var b=b!==!1,c=gantt._get_visible_milestone_width()/2;return this._get_task_coord(a,b,c)};gantt._correct_shift=function(a,b){return a-=((new Date(gantt._min_date)).getTimezoneOffset()-(new Date(a)).getTimezoneOffset())*6E4*(b?-1:1)};
gantt._scroll_task_area=function(a,b){if(a*1===a)this.$task.scrollLeft=a;if(b*1===b)this.$task_data.scrollTop=b};gantt._get_mouse_pos=function(a){if(a.pageX||a.pageY)var b={x:a.pageX,y:a.pageY};var c=_isIE?document.documentElement:document.body,b={x:a.clientX+c.scrollLeft-c.clientLeft,y:a.clientY+c.scrollTop-c.clientTop},d=gantt._get_position(gantt.$task_data);b.x=b.x-d.x+gantt.$task_data.scrollLeft;b.y=b.y-d.y+gantt.$task_data.scrollTop;return b};
gantt._task_renderer=function(a,b,c){if(!this._task_area_pulls)this._task_area_pulls={};if(!this._task_area_renderers)this._task_area_renderers={};if(this._task_area_renderers[a])return this._task_area_renderers[a];this._task_area_renderers[a]={render_item:function(d,e){var f=gantt._task_area_pulls[a],e=e||c,g=b.call(gantt,d);g&&(f[d.id]?this.replace_item(d.id,g):(f[d.id]=g,e.appendChild(g)))},render_items:function(b,e){this.rendered=gantt._task_area_pulls[a]={};e=e||c;e.innerHTML="";for(var f=document.createDocumentFragment(),
g=0,h=b.length;g<h;g++)this.render_item(b[g],f);e.appendChild(f)},replace_item:function(a,b){var c=this.rendered[a];c&&c.parentNode&&c.parentNode.replaceChild(b,c);this.rendered[a]=b},remove_item:function(a){var b=this.rendered[a];b&&b.parentNode&&b.parentNode.removeChild(b);delete this.rendered[a]},change_id:function(a,b){this.rendered[b]=this.rendered[a];delete this.rendered[a]},rendered:this._task_area_pulls[a],node:c};return this._task_area_renderers[a]};
gantt.showTask=function(a){var b=this.getTaskNode(a),c=Math.max(b.offsetLeft-this.config.task_scroll_offset,0),d=b.offsetTop-(this.$task_data.offsetHeight-this.config.row_height)/2;this._scroll_task_area(c,d)};gantt._pull={};gantt._branches={};gantt._order=[];gantt._lpull={};
gantt.load=function(a,b,c){this.callEvent("onLoadStart",[]);var d="json",e=null;arguments.length>=3?(d=b,e=c):typeof arguments[1]=="string"?d=arguments[1]:typeof arguments[1]=="function"&&(e=arguments[1]);dhtmlxAjax.get(a,dhtmlx.bind(function(a){this.on_load(a,d);typeof e=="function"&&e.call(this)},this))};gantt.parse=function(a,b){this.on_load({xmlDoc:{responseText:a}},b)};gantt.serialize=function(a){a=a||"json";return this[a].serialize()};
gantt.on_load=function(a,b){b||(b="json");var c=a.xmlDoc.responseText,d=this[b].parse(c,a);this._process_loading(d);this.callEvent("onLoadEnd",[])};
gantt._process_loading=function(a){a.collections&&this._load_collections(a.collections);for(var b=a.data,c=0;c<b.length;c++){var d=b[c];this._init_task(d);this.callEvent("onTaskLoading",[d])&&(this._pull[d.id]=d,this._branches[d.parent]||(this._branches[d.parent]=[]),this._branches[d.parent].push(d.id))}this._sync_order();for(c in this._pull)this._pull[c].$level=this._item_level(this._pull[c]);this._init_links(a.links||(a.collections?a.collections.links:[]))};
gantt._init_links=function(a){if(a)for(var b=0;b<a.length;b++)if(a[b]){var c=this._init_link(a[b]);this._lpull[c.id]=c}this._sync_links()};gantt._load_collections=function(a){var b=!1,c;for(c in a)if(a.hasOwnProperty(c)){var b=!0,d=a[c],e=this.serverList[c];if(e){e.splice(0,e.length);for(var f=0;f<d.length;f++){var g=d[f],h=dhtmlx.copy(g);h.key=h.value;for(var i in g)if(g.hasOwnProperty(i)&&!(i=="value"||i=="label"))h[i]=g[i];e.push(h)}}}b&&this.callEvent("onOptionsLoad",[])};
gantt._sync_order=function(){this._order=[];this._sync_order_item({parent:0,$open:!0,$ignore:!0,id:0});this._scroll_resize();this._set_sizes()};gantt.attachEvent("onBeforeTaskDisplay",function(a,b){return!b.$ignore});gantt._sync_order_item=function(a){a.id&&this.callEvent("onBeforeTaskDisplay",[a.id,a])&&this._order.push(a.id);if(a.$open){var b=this._branches[a.id];if(b)for(var c=0;c<b.length;c++)this._sync_order_item(this._pull[b[c]])}};
gantt._get_visible_order=function(a){for(var b=this._order,c=0,d=b.length;c<d;c++)if(b[c]==a)return c;return-1};gantt.eachTask=function(a,b,c){var b=b||0,c=c||this,d=this._branches[b];if(d)for(var e=0;e<d.length;e++){var f=this._pull[d[e]];a.call(c,f);this._branches[f.id]&&this.eachTask(a,f.id,c)}};
gantt.json={parse:function(a){if(typeof a=="string")window.JSON?a=JSON.parse(a):(gantt._temp=eval("("+a+")"),a=gantt._temp||{},gantt._temp=null);if(a.dhx_security)dhtmlx.security_key=a.dhx_security;return a},_copyLink:function(a){var b={},c;for(c in a)b[c]=a[c];return b},_copyObject:function(a){var b={},c;for(c in a)c.charAt(0)!="$"&&(b[c]=a[c]);b.start_date=gantt.templates.xml_format(b.start_date);if(b.end_date)b.end_date=gantt.templates.xml_format(b.end_date);return b},serialize:function(){var a=
[],b=[];gantt.eachTask(function(b){a.push(this._copyObject(b))},0,this);for(var c in gantt._lpull)b.push(this._copyLink(gantt._lpull[c]));return{data:a,links:b}}};
gantt.xml={_xmlNodeToJSON:function(a,b){for(var c={},d=0;d<a.attributes.length;d++)c[a.attributes[d].name]=a.attributes[d].value;if(!b){for(d=0;d<a.childNodes.length;d++){var e=a.childNodes[d];e.nodeType==1&&(c[e.tagName]=e.firstChild?e.firstChild.nodeValue:"")}if(!c.text)c.text=a.firstChild?a.firstChild.nodeValue:""}return c},_getCollections:function(a){for(var b={},c=a.doXPath("//coll_options"),d=0;d<c.length;d++)for(var e=c[d].getAttribute("for"),f=b[e]=[],g=a.doXPath(".//item",c[d]),h=0;h<g.length;h++){for(var i=
g[h],j=i.attributes,k={key:g[h].getAttribute("value"),label:g[h].getAttribute("label")},n=0;n<j.length;n++){var l=j[n];if(!(l.nodeName=="value"||l.nodeName=="label"))k[l.nodeName]=l.nodeValue}f.push(k)}return b},_getXML:function(a,b,c){c=c||"data";b.getXMLTopNode||(b=new dtmlXMLLoaderObject(function(){}),b.loadXMLString(a));xml=b.getXMLTopNode(c);if(xml.tagName!=c)throw"Invalid XML data";var d=xml.getAttribute("dhx_security");if(d)dhtmlx.security_key=d;return b},parse:function(a,b){var b=this._getXML(a,
b),c={},d=c.data=[];xml=b.doXPath("//task");for(var e=0;e<xml.length;e++)d[e]=this._xmlNodeToJSON(xml[e]);c.collections=this._getCollections(b);return c},_copyLink:function(a){return"<item id='"+a.id+"' source='"+a.source+"' target='"+a.target+"' type='"+a.type+"' />"},_copyObject:function(a){var b=gantt.templates.xml_format(a.start_date),c=gantt.templates.xml_format(a.end_date);return"<task id='"+a.id+"' parent='"+(a.parent||"")+"' start_date='"+b+"' duration='"+a.duration+"' open='"+!!a.open+"' progress='"+
a.progress+"' end_date='"+c+"'><![CDATA["+a.text+"]]\></task>"},serialize:function(){var a=[],b=[];gantt.eachTask(function(b){a.push(this._copyObject(b))},0,this);for(var c in gantt._lpull)b.push(this._copyLink(gantt._lpull[c]));return"<data>"+a.join("")+"<coll_options for='links'>"+b.join("")+"</coll_options></data>"}};
gantt.oldxml={parse:function(a,b){var b=gantt.xml._getXML(a,b,"projects"),c={collections:{links:[]}},d=c.data=[];xml=b.doXPath("//task");for(var e=0;e<xml.length;e++){d[e]=gantt.xml._xmlNodeToJSON(xml[e]);var f=xml[e].parentNode;d[e].parent=f.tagName=="project"?"project-"+f.getAttribute("id"):f.parentNode.getAttribute("id")}xml=b.doXPath("//project");for(e=0;e<xml.length;e++){var g=gantt.xml._xmlNodeToJSON(xml[e],!0);g.id="project-"+g.id;d.push(g)}for(e=0;e<d.length;e++){g=d[e];g.start_date=g.startdate||
g.est;g.end_date=g.enddate;g.text=g.name;g.duration/=8;g.open=1;if(!g.duration&&!g.end_date)g.duration=1;g.predecessortasks&&c.collections.links.push({target:g.id,source:g.predecessortasks,type:gantt.config.links.finish_to_start})}return c},serialize:function(){webix.message("Serialization to 'old XML' is not implemented")}};gantt.serverList=function(a,b){return b?this.serverList[a]=b.slice(0):this.serverList[a]=this.serverList[a]||[]};gantt.getTask=function(a){return this._pull[a]};
gantt.getTaskByTime=function(a,b){var c=this._pull,d=[],e=0,f=0;if(!a&&!b)for(var g in c)d.push(c[g]);else for(g in a=+a||-Infinity,b=+b||Infinity,c){var h=c[g];+h.start_date<b&&+h.end_date>a&&d.push(h)}return d};gantt.isTaskExists=function(a){return dhtmlx.defined(this._pull[a])};
gantt.isTaskVisible=function(a){if(!this._pull[a])return!1;if(!(+this._pull[a].start_date<+this._max_date&&+this._pull[a].end_date>+this._min_date))return!1;for(var b=0,c=this._order.length;b<c;b++)if(this._order[b]==a)return!0;return!1};gantt.updateTask=function(a,b){dhtmlx.defined(b)||(b=this.getTask(a));if(this.callEvent("onBeforeTaskUpdate",[a,b])===!1)return!1;this._pull[b.id]=b;this._update_parents(b.id);this.refreshTask(b.id);this.callEvent("onAfterTaskUpdate",[a,b]);this._sync_order();this._adjust_scales()};
gantt.addTask=function(a,b){dhtmlx.defined(b)||(b=a.parent||0);dhtmlx.defined(this._pull[b])||(b=0);a.parent=b;a=this._init_task(a);if(this.callEvent("onBeforeTaskAdd",[a.id,a])===!1)return!1;this._pull[a.id]=a;this._branches[a.parent]||(this._branches[a.parent]=[]);this._branches[a.parent].push(a.id);this.refreshData();this.callEvent("onAfterTaskAdd",[a.id,a]);this._adjust_scales();return a.id};gantt.deleteTask=function(a){return this._deleteTask(a)};
gantt._deleteTask=function(a,b){var c=this.getTask(a);if(!b&&this.callEvent("onBeforeTaskDelete",[a,c])===!1)return!1;!b&&this._dp&&this._dp.setUpdateMode("off");var d=this._branches[c.id]||[];if(this._selected_task==a)this._selected_task=null;for(var e=0;e<d.length;e++){this._silentStart();this._deleteTask(d[e],!0);if(this._dp)this._dp._ganttMode="tasks",this._dp.setUpdated(d[e],!0,"deleted");this._silentEnd()}for(!b&&this._dp&&this._dp.setUpdateMode("cell");c.$source.length>0;)this.deleteLink(c.$source[0]);
for(;c.$target.length>0;)this.deleteLink(c.$target[0]);delete this._pull[a];delete this._branches[a];this._branch_update(c.parent,a);b||(this.callEvent("onAfterTaskDelete",[a,c]),this.refreshData());return!0};gantt.clearAll=function(){this._pull={};this._branches={};this._order=[];this._order_full=[];this._lpull={};this.refreshData();this.callEvent("onClear",[])};
gantt.changeTaskId=function(a,b){var c=this._pull[b]=this._pull[a];this._pull[b].id=b;delete this._pull[a];for(var d in this._pull)if(this._pull[d].parent==a)this._pull[d].parent=b;if(this._lightbox_id==a)this._lightbox_id=b;this._branch_update(c.parent,a,b);this._sync_order();this.callEvent("onTaskIdChange",[a,b])};gantt._branch_update=function(a,b,c){var d=this._branches[a];if(d){for(var e=[],f=0;f<d.length;f++)d[f]!=b?e.push(d[f]):c&&e.push(c);this._branches[a]=e}};
gantt._get_duration_unit=function(){return gantt._get_line(this.config.duration_unit)*1E3||this.config.duration_unit};gantt.getTaskType=function(a){a+="";return gantt.config.types[a]||gantt.config.types.task};
gantt._init_task=function(a){if(!dhtmlx.defined(a.id)||this._pull[a.id])a.id=dhtmlx.uid();if(a.start_date)a.start_date=gantt.date.parseDate(a.start_date,"xml_date");if(a.end_date)a.end_date=gantt.date.parseDate(a.end_date,"xml_date");var b=this._get_duration_unit();if(a.start_date&&!a.end_date&&a.duration)a.end_date=new Date(a.start_date.valueOf()+a.duration*b);gantt._init_task_timing(a);a.$source=[];a.$target=[];a.parent=a.parent||0;a.$open=dhtmlx.defined(a.open)?a.open:!1;a.$level=this._item_level(a);
return a};
gantt._init_task_timing=function(a){if(a.$rendered_type===void 0)a.$rendered_type=a.type;else if(a.$rendered_type!=a.type)delete a.$no_end,delete a.$no_start,a.$rendered_type=a.type;if((a.$no_end===void 0||a.$no_start===void 0)&&a.type!=this.config.types.milestone)a.type==this.config.types.project?a.$no_end=a.$no_start=!0:(a.$no_end=!(a.end_date||a.duration),a.$no_start=!a.start_date);if(a.type==this.config.types.milestone)a.end_date=a.start_date;if(a.start_date&&a.end_date)a.duration=Math.round((a.end_date-a.start_date)/
(this.config.duration_step*this._get_duration_unit()));a.duration=a.duration||0};gantt._is_flex_task=function(a){return!(!a.$no_end&&!a.$no_start)};
gantt._update_parents=function(a,b){if(a){for(var c=this.getTask(a);!c.$no_end&&!c.$no_start&&c.parent&&this.isTaskExists(c.parent);)c=this.getTask(c.parent);if(c.$no_end){var d=0;this.eachTask(function(a){a.end_date&&+a.end_date>+d&&(d=new Date(a.end_date))},c.id);if(d)c.end_date=d}if(c.$no_start){var e=Infinity;this.eachTask(function(a){a.start_date&&+a.start_date<+e&&(e=new Date(a.start_date))},c.id);if(e!=Infinity)c.start_date=e}if(c.$no_end||c.$no_start)this._init_task_timing(c),b||this.refreshTask(c.id,
!0);c.parent&&this.isTaskExists(c.parent)&&this._update_parents(c.parent,b)}};gantt._round_date=function(a,b,c){for(var d=gantt.date[c+"_start"](new Date(this._min_date));+d<+a;)d=gantt.date.add(d,b,c);var e=gantt.date.add(d,-1*b,c);return Math.abs(a-e)<Math.abs(d-a)?e:d};
gantt._round_task_dates=function(a,b,c){a.start_date=this._round_date(+a.start_date,b,c);a.end_date=this._round_date(+a.end_date,b,c);if(a.end_date<=a.start_date)b=b||gantt._tasks.step,c=c||gantt._tasks.unit,a.end_date=gantt.date.add(a.start_date,b,c);this._init_task_timing(a)};gantt.attachEvent("onBeforeTaskUpdate",function(a,b){gantt._init_task_timing(b);return!0});gantt.attachEvent("onBeforeTaskAdd",function(a,b){gantt._init_task_timing(b);return!0});
gantt._item_level=function(a){for(var b=0;a.parent;){if(!dhtmlx.defined(this._pull[a.parent]))break;a=this._pull[a.parent];b++}return b};gantt.sort=function(a,b,c,d){var e=!d;dhtmlx.defined(c)||(c=0);dhtmlx.defined(a)||(a="order");var f=typeof a=="string"?function(c,d){var e=c[a]>d[a];b&&(e=!e);return e?1:-1}:a,g=this._branches[c];if(g){for(var h=[],i=g.length-1;i>=0;i--)h[i]=this._pull[g[i]];h.sort(f);for(i=0;i<h.length;i++)g[i]=h[i].id,this.sort(a,b,g[i],!0)}e&&this.refreshData()};
gantt.getNext=function(a){for(var b=0;b<this._order.length-1;b++)if(this._order[b]==a)return this._order[b+1];return null};gantt.getPrev=function(a){for(var b=1;b<this._order.length;b++)if(this._order[b]==a)return this._order[b-1];return null};
gantt._dp_init=function(a){a.setTransactionMode("POST",!0);a.serverProcessor+=(a.serverProcessor.indexOf("?")!=-1?"&":"?")+"editing=true";a._serverProcessor=a.serverProcessor;a.styles={updated:"gantt_updated",inserted:"gantt_inserted",deleted:"gantt_deleted",invalid:"gantt_invalid",error:"gantt_error",clear:""};a._methods=["_row_style","setCellTextStyle","_change_id","_delete_task"];this.attachEvent("onAfterTaskAdd",function(b){a._ganttMode="tasks";a.setUpdated(b,!0,"inserted")});this.attachEvent("onAfterTaskUpdate",
function(b){a._ganttMode="tasks";a.setUpdated(b,!0)});this.attachEvent("onAfterTaskDelete",function(b){a._ganttMode="tasks";a.setUpdated(b,!0,"deleted")});this.attachEvent("onAfterLinkUpdate",function(b){a._ganttMode="links";a.setUpdated(b,!0)});this.attachEvent("onAfterLinkAdd",function(b){a._ganttMode="links";a.setUpdated(b,!0,"inserted")});this.attachEvent("onAfterLinkDelete",function(b){a._ganttMode="links";a.setUpdated(b,!0,"deleted")});this.attachEvent("onRowDragEnd",function(b,c){a._ganttMode=
"tasks";this.getTask(b).target=c;a.setUpdated(b,!0,"order")});a.attachEvent("onBeforeDataSending",function(){this.serverProcessor=this._serverProcessor+getUrlSymbol(this._serverProcessor)+"gantt_mode="+this._ganttMode;return!0});a._getRowData=dhtmlx.bind(function(b){var c;c=a._ganttMode=="tasks"?this.isTaskExists(b)?this.getTask(b):{id:b}:this.isLinkExists(b)?this.getLink(b):{id:b};var d={},e;for(e in c)if(e.substr(0,1)!="$"){var f=c[e];d[e]=f instanceof Date?this.templates.xml_format(f):f}if(c.$no_start)c.start_date=
"",c.duration="";if(c.$no_end)c.end_date="",c.duration="";d[a.action_param]=this.getUserData(b,a.action_param);return d},this);this._change_id=dhtmlx.bind(function(b,c){a._ganttMode!="tasks"?this.changeLinkId(b,c):this.changeTaskId(b,c)},this);this._row_style=function(b,c){if(a._ganttMode=="tasks"){var d=gantt.getTaskRowNode(b);if(d)if(c)d.className+=" "+c;else{var e=/ (gantt_updated|gantt_inserted|gantt_deleted|gantt_invalid|gantt_error)/g;d.className=d.className.replace(e,"")}}};this._delete_task=
function(){};this._dp=a};gantt.getUserData=function(a,b){if(!this.userdata)this.userdata={};return this.userdata[a]&&this.userdata[a][b]?this.userdata[a][b]:""};gantt.setUserData=function(a,b,c){if(!this.userdata)this.userdata={};this.userdata[a]||(this.userdata[a]={});this.userdata[a][b]=c};gantt._init_link=function(a){if(!dhtmlx.defined(a.id))a.id=dhtmlx.uid();return a};
gantt._sync_links=function(){for(var a in this._pull)this._pull[a].$source=[],this._pull[a].$target=[];for(a in this._lpull){var b=this._lpull[a];this._pull[b.source]&&this._pull[b.source].$source.push(a);this._pull[b.target]&&this._pull[b.target].$target.push(a)}};gantt.getLink=function(a){return this._lpull[a]};gantt.isLinkExists=function(a){return dhtmlx.defined(this._lpull[a])};
gantt.addLink=function(a){a=this._init_link(a);if(this.callEvent("onBeforeLinkAdd",[a.id,a])===!1)return!1;this._lpull[a.id]=a;this._sync_links();this._render_link(a.id);this.callEvent("onAfterLinkAdd",[a.id,a]);return a.id};gantt.updateLink=function(a,b){dhtmlx.defined(b)||(b=this.getLink(a));if(this.callEvent("onBeforeLinkUpdate",[a,b])===!1)return!1;this._lpull[a]=b;this._sync_links();this._render_link(a);this.callEvent("onAfterLinkUpdate",[a,b]);return!0};gantt.deleteLink=function(a){return this._deleteLink(a)};
gantt._deleteLink=function(a,b){var c=this.getLink(a);if(!b&&this.callEvent("onBeforeLinkDelete",[a,c])===!1)return!1;delete this._lpull[a];this._sync_links();this.refreshLink(a);b||this.callEvent("onAfterLinkDelete",[a,c]);return!0};gantt.changeLinkId=function(a,b){this._lpull[b]=this._lpull[a];this._lpull[b].id=b;delete this._lpull[a];this._sync_links();this.callEvent("onLinkIdChange",[a,b])};gantt.getChildren=function(a){return dhtmlx.defined(this._branches[a])?this._branches[a]:[]};
gantt.hasChild=function(a){return dhtmlx.defined(this._branches[a])};gantt.refreshData=function(){this._sync_order();this._render_data()};gantt._configure=function(a,b){for(var c in b)typeof a[c]=="undefined"&&(a[c]=b[c])};
gantt._init_skin=function(){if(!gantt.skin)for(var a=document.getElementsByTagName("link"),b=0;b<a.length;b++){var c=a[b].href.match("dhtmlxgantt_([a-z]+).css");if(c){gantt.skin=c[1];break}}if(!gantt.skin)gantt.skin="terrace";var d=gantt.skins[gantt.skin];this._configure(gantt.config,d.config);var e=gantt.config.columns;if(e[1]&&typeof e[1].width=="undefined")e[1].width=d._second_column_width;if(e[2]&&typeof e[2].width=="undefined")e[2].width=d._third_column_width;if(d._lightbox_template)gantt._lightbox_template=
d._lightbox_template;gantt._init_skin=function(){}};gantt.skins={};gantt._lightbox_methods={};gantt._lightbox_template="<div class='dhx_cal_ltitle'><span class='dhx_mark'>&nbsp;</span><span class='dhx_time'></span><span class='dhx_title'></span></div><div class='dhx_cal_larea'></div>";
gantt.showLightbox=function(a){if(a&&this.callEvent("onBeforeLightbox",[a])){var b=this.getTask(a),c=this.getLightbox(this.getTaskType(b.type));this._center_lightbox(c);this.showCover();this._fill_lightbox(a,c);this.callEvent("onLightbox",[a])}};gantt._get_timepicker_step=function(){if(this.config.round_dnd_dates){var a=gantt._tasks,b=this._get_line(a.unit)*a.step/60;if(b>=1440)b=this.config.time_step;return b}return this.config.time_step};
gantt.getLabel=function(a,b){for(var c=this._get_typed_lightbox_config(),d=0;d<c.length;d++)if(c[d].map_to==a)for(var e=c[d].options,f=0;f<e.length;f++)if(e[f].key==b)return e[f].label;return""};gantt.updateCollection=function(a,b){var c=gantt.serverList(a);if(!c)return!1;c.splice(0,c.length);c.push.apply(c,b||[]);gantt.resetLightbox()};gantt.getLightboxType=function(){return this.getTaskType(this._lightbox_type)};
gantt.getLightbox=function(a){a===void 0&&(a=this.getLightboxType());if(!this._lightbox||this.getLightboxType()!=this.getTaskType(a)){this._lightbox_type=this.getTaskType(a);var b=document.createElement("DIV");b.className="dhx_cal_light";var c=this._is_lightbox_timepicker();if(gantt.config.wide_form||c)b.className+=" dhx_cal_light_wide";if(c)gantt.config.wide_form=!0,b.className+=" dhx_cal_light_full";b.style.visibility="hidden";var d=this._lightbox_template,e=this.config.buttons_left,f;for(f in e)d+=
"<div class='dhx_btn_set dhx_left_btn_set "+e[f]+"_set'><div dhx_button='1' class='"+e[f]+"'></div><div>"+this.locale.labels[e[f]]+"</div></div>";e=this.config.buttons_right;for(f in e)d+="<div class='dhx_btn_set dhx_right_btn_set "+e[f]+"_set' style='float:right;'><div dhx_button='1' class='"+e[f]+"'></div><div>"+this.locale.labels[e[f]]+"</div></div>";d+="</div>";b.innerHTML=d;if(gantt.config.drag_lightbox)b.firstChild.onmousedown=gantt._ready_to_dnd,b.firstChild.onselectstart=function(){return!1},
b.firstChild.style.cursor="pointer",gantt._init_dnd_events();document.body.insertBefore(b,document.body.firstChild);this._lightbox=b;var g=this._get_typed_lightbox_config(a),d=this._render_sections(g),h=b.getElementsByTagName("div");for(f=0;f<h.length;f++){var i=h[f];if(i.className=="dhx_cal_larea"){i.innerHTML=d;break}}this.resizeLightbox();this._init_lightbox_events(this);b.style.display="none";b.style.visibility="visible"}return this._lightbox};
gantt._render_sections=function(a){for(var b="",c=0;c<a.length;c++){var d=this.form_blocks[a[c].type];if(d){a[c].id="area_"+dhtmlx.uid();var e=a[c].hidden?" style='display:none'":"",f="";a[c].button&&(f="<div class='dhx_custom_button' index='"+c+"'><div class='dhx_custom_button_"+a[c].button+"'></div><div>"+this.locale.labels["button_"+a[c].button]+"</div></div>");this.config.wide_form&&(b+="<div class='dhx_wrap_section' "+e+">");b+="<div id='"+a[c].id+"' class='dhx_cal_lsection'>"+f+this.locale.labels["section_"+
a[c].name]+"</div>"+d.render.call(this,a[c]);b+="</div>"}}return b};gantt.resizeLightbox=function(){var a=this._lightbox;if(a){var b=a.childNodes[1];b.style.height="0px";b.style.height=b.scrollHeight+"px";a.style.height=b.scrollHeight+this.config.lightbox_additional_height+"px";b.style.height=b.scrollHeight+"px"}};
gantt._center_lightbox=function(a){if(a){a.style.display="block";var b=window.pageYOffset||document.body.scrollTop||document.documentElement.scrollTop,c=window.pageXOffset||document.body.scrollLeft||document.documentElement.scrollLeft,d=window.innerHeight||document.documentElement.clientHeight;a.style.top=b?Math.round(b+Math.max((d-a.offsetHeight)/2,0))+"px":Math.round(Math.max((d-a.offsetHeight)/2,0)+9)+"px";a.style.left=document.documentElement.scrollWidth>document.body.offsetWidth?Math.round(c+
(document.body.offsetWidth-a.offsetWidth)/2)+"px":Math.round((document.body.offsetWidth-a.offsetWidth)/2)+"px"}};gantt.showCover=function(){if(!this._cover){this._cover=document.createElement("DIV");this._cover.className="dhx_cal_cover";var a=document.height!==void 0?document.height:document.body.offsetHeight,b=document.documentElement?document.documentElement.scrollHeight:0;this._cover.style.height=Math.max(a,b)+"px";document.body.appendChild(this._cover)}};
gantt._init_lightbox_events=function(){gantt.lightbox_events={};gantt.lightbox_events.dhx_save_btn=function(){gantt._save_lightbox()};gantt.lightbox_events.dhx_delete_btn=function(){if(gantt.callEvent("onLightboxDelete",[gantt._lightbox_id]))gantt.$click.buttons["delete"](gantt._lightbox_id)};gantt.lightbox_events.dhx_cancel_btn=function(){gantt._cancel_lightbox()};gantt.lightbox_events["default"]=function(a,b){if(b.getAttribute("dhx_button"))gantt.callEvent("onLightboxButton",[b.className,b,a]);
else{var c,d,e;if(b.className.indexOf("dhx_custom_button")!=-1)b.className.indexOf("dhx_custom_button_")!=-1?(c=b.parentNode.getAttribute("index"),e=b.parentNode.parentNode):(c=b.getAttribute("index"),e=b.parentNode,b=b.firstChild);var f=gantt._get_typed_lightbox_config();c&&(d=gantt.form_blocks[f[c].type],d.button_click(c,b,e,e.nextSibling))}};dhtmlxEvent(gantt.getLightbox(),"click",function(a){var a=a||window.event,b=a.target?a.target:a.srcElement;if(!b.className)b=b.previousSibling;if(b&&b.className&&
b.className.indexOf("dhx_btn_set")===0)b=b.firstChild;if(b&&b.className){var c=dhtmlx.defined(gantt.lightbox_events[b.className])?gantt.lightbox_events[b.className]:gantt.lightbox_events["default"];return c(a,b)}return!1});gantt.getLightbox().onkeydown=function(a){switch((a||event).keyCode){case gantt.keys.edit_save:if((a||event).shiftKey)break;gantt._save_lightbox();break;case gantt.keys.edit_cancel:gantt._cancel_lightbox()}}};
gantt._cancel_lightbox=function(){this.callEvent("onLightboxCancel",[this._lightbox_id,this.$new]);this.hideLightbox()};gantt._save_lightbox=function(){var a=this.getLightboxValues();this.callEvent("onLightboxSave",[this._lightbox_id,a,!!a.$new])&&(a.$new?this.addTask(a):(dhtmlx.mixin(this.getTask(a.id),a,!0),this.updateTask(a.id)),this.refreshData(),this.hideLightbox())};
gantt.getLightboxValues=function(){for(var a=dhtmlx.mixin({},this.getTask(this._lightbox_id)),b=this._get_typed_lightbox_config(),c=0;c<b.length;c++){var d=document.getElementById(b[c].id),d=d?d.nextSibling:d,e=this.form_blocks[b[c].type],f=e.get_value.call(this,d,a,b[c]);b[c].map_to!="auto"&&(a[b[c].map_to]=f)}return a};gantt.hideLightbox=function(){var a=this.getLightbox();if(a)a.style.display="none";this._lightbox_id=null;this.hideCover();this.callEvent("onAfterLightbox",[])};
gantt.hideCover=function(){this._cover&&this._cover.parentNode.removeChild(this._cover);this._cover=null};gantt.resetLightbox=function(){gantt._lightbox&&!gantt._custom_lightbox&&gantt._lightbox.parentNode.removeChild(gantt._lightbox);gantt._lightbox=null};
gantt._set_lightbox_values=function(a,b){var c=a,d=b.getElementsByTagName("span");gantt.templates.lightbox_header?(d[1].innerHTML="",d[2].innerHTML=gantt.templates.lightbox_header(c.start_date,c.end_date,c)):(d[1].innerHTML=this.templates.task_time(c.start_date,c.end_date,c),d[2].innerHTML=(this.templates.task_text(c.start_date,c.end_date,c)||"").substr(0,70));for(var e=this._get_typed_lightbox_config(this.getLightboxType()),f=0;f<e.length;f++){var g=e[f];if(this.form_blocks[g.type]){var h=document.getElementById(g.id).nextSibling,
i=this.form_blocks[g.type],j=dhtmlx.defined(c[g.map_to])?c[g.map_to]:g.default_value;i.set_value.call(this,h,j,c,g);g.focus&&i.focus.call(this,h)}}if(a.id)gantt._lightbox_id=a.id};gantt._fill_lightbox=function(a,b){var c=this.getTask(a);this._set_lightbox_values(c,b)};
gantt.getLightboxSection=function(a){for(var b=this._get_typed_lightbox_config(),c=0;c<b.length;c++)if(b[c].name==a)break;var d=b[c];this._lightbox||this.getLightbox();var e=document.getElementById(d.id),f=e.nextSibling,g={section:d,header:e,node:f,getValue:function(a){return this.form_blocks[d.type].get_value(f,a||{},d)},setValue:function(a,b){return this.form_blocks[d.type].set_value(f,a,b||{},d)}},h=this._lightbox_methods["get_"+d.type+"_control"];return h?h(g):g};
gantt._lightbox_methods.get_template_control=function(a){a.control=a.node;return a};gantt._lightbox_methods.get_select_control=function(a){a.control=a.node.getElementsByTagName("select")[0];return a};gantt._lightbox_methods.get_textarea_control=function(a){a.control=a.node.getElementsByTagName("textarea")[0];return a};gantt._lightbox_methods.get_time_control=function(a){a.control=a.node.getElementsByTagName("select");return a};
gantt._init_dnd_events=function(){dhtmlxEvent(document.body,"mousemove",gantt._move_while_dnd);dhtmlxEvent(document.body,"mouseup",gantt._finish_dnd);gantt._init_dnd_events=function(){}};
gantt._move_while_dnd=function(a){if(gantt._dnd_start_lb){if(!document.dhx_unselectable)document.body.className+=" dhx_unselectable",document.dhx_unselectable=!0;var b=gantt.getLightbox(),c=a&&a.target?[a.pageX,a.pageY]:[event.clientX,event.clientY];b.style.top=gantt._lb_start[1]+c[1]-gantt._dnd_start_lb[1]+"px";b.style.left=gantt._lb_start[0]+c[0]-gantt._dnd_start_lb[0]+"px"}};
gantt._ready_to_dnd=function(a){var b=gantt.getLightbox();gantt._lb_start=[parseInt(b.style.left,10),parseInt(b.style.top,10)];gantt._dnd_start_lb=a&&a.target?[a.pageX,a.pageY]:[event.clientX,event.clientY]};gantt._finish_dnd=function(){if(gantt._lb_start)gantt._lb_start=gantt._dnd_start_lb=!1,document.body.className=document.body.className.replace(" dhx_unselectable",""),document.dhx_unselectable=!1};gantt._focus=function(a,b){a&&a.focus&&!gantt.config.touch&&(b&&a.select&&a.select(),a.focus())};
gantt.form_blocks={getTimePicker:function(a,b){var c=a.time_format;c||(c=["%d","%m","%Y"],gantt._get_line(gantt._tasks.unit)<gantt._get_line("day")&&c.push("%H:%i"));a._time_format_order={size:0};var d=this.config,e=this.date.date_part(new Date(gantt._min_date.valueOf())),f=1440,g=0;gantt.config.limit_time_select&&(f=60*d.last_hour+1,g=60*d.first_hour,e.setHours(d.first_hour));for(var h="",i=0;i<c.length;i++){var j=c[i];i>0&&(h+=" ");var k="";switch(j){case "%Y":a._time_format_order[2]=i;a._time_format_order.size++;
for(var n=e.getFullYear()-5,l=0;l<10;l++)k+="<option value='"+(n+l)+"'>"+(n+l)+"</option>";break;case "%m":a._time_format_order[1]=i;a._time_format_order.size++;for(l=0;l<12;l++)k+="<option value='"+l+"'>"+this.locale.date.month_full[l]+"</option>";break;case "%d":a._time_format_order[0]=i;a._time_format_order.size++;for(l=1;l<32;l++)k+="<option value='"+l+"'>"+l+"</option>";break;case "%H:%i":f=1440;g=0;a._time_format_order[3]=i;a._time_format_order.size++;var l=g,m=e.getDate();for(a._time_values=
[];l<f;){var o=this.templates.time_picker(e);k+="<option value='"+l+"'>"+o+"</option>";a._time_values.push(l);e.setTime(e.valueOf()+this._get_timepicker_step()*6E4);var p=e.getDate()!=m?1:0,l=p*1440+e.getHours()*60+e.getMinutes()}}if(k){var A=a.readonly?"disabled='disabled'":"",B=b?" style='display:none'":"";h+="<select "+A+B+">"+k+"</select>"}}return h},_fill_lightbox_select:function(a,b,c,d){a[b+d[0]].value=c.getDate();a[b+d[1]].value=c.getMonth();a[b+d[2]].value=c.getFullYear();if(dhtmlx.defined(d[3])){var e=
c.getHours()*60+c.getMinutes(),e=Math.round(e/gantt._get_timepicker_step())*gantt._get_timepicker_step();a[b+d[3]].value=e}},template:{render:function(a){var b=(a.height||"30")+"px";return"<div class='dhx_cal_ltext dhx_cal_template' style='height:"+b+";'></div>"},set_value:function(a,b){a.innerHTML=b||""},get_value:function(a){return a.innerHTML||""},focus:function(){}},textarea:{render:function(a){var b=(a.height||"130")+"px";return"<div class='dhx_cal_ltext' style='height:"+b+";'><textarea></textarea></div>"},
set_value:function(a,b){a.firstChild.value=b||""},get_value:function(a){return a.firstChild.value},focus:function(a){var b=a.firstChild;gantt._focus(b,!0)}},select:{render:function(a){for(var b=(a.height||"23")+"px",c="<div class='dhx_cal_ltext' style='height:"+b+";'><select style='width:100%;'>",d=0;d<a.options.length;d++)c+="<option value='"+a.options[d].key+"'>"+a.options[d].label+"</option>";c+="</select></div>";return c},set_value:function(a,b,c,d){var e=a.firstChild;if(!e._dhx_onchange&&d.onchange)e.onchange=
d.onchange,e._dhx_onchange=!0;if(typeof b=="undefined")b=(e.options[0]||{}).value;e.value=b||""},get_value:function(a){return a.firstChild.value},focus:function(a){var b=a.firstChild;gantt._focus(b,!0)}},time:{render:function(a){var b=this.form_blocks.getTimePicker.call(this,a),c=["<div style='height:30px;padding-top:0px;font-size:inherit;text-align:center;' class='dhx_section_time'>"];c.push(b);a.single_date?(b=this.form_blocks.getTimePicker.call(this,a,!0),c.push("<span></span>")):c.push("<span style='font-weight:normal; font-size:10pt;'> &nbsp;&ndash;&nbsp; </span>");
c.push(b);c.push("</div>");return c.join("")},set_value:function(a,b,c,d){var e=this.config,f=a.getElementsByTagName("select"),g=d._time_format_order,h=d._time_format_size;if(e.auto_end_date&&e.event_duration)for(var i=function(){var a=new Date(f[g[2]].value,f[g[1]].value,f[g[0]].value,0,0),b=new Date(a.getTime()+gantt.config.event_duration*6E4);this.form_blocks._fill_lightbox_select(f,g.size,b,g,e)},j=0;j<4;j++)f[j].onchange=i;this.form_blocks._fill_lightbox_select(f,0,c.start_date,g,e);this.form_blocks._fill_lightbox_select(f,
g.size,c.end_date,g,e)},get_value:function(a,b,c){var d=a.getElementsByTagName("select"),e=c._time_format_order,f=0,g=0;if(dhtmlx.defined(e[3]))var h=parseInt(d[e[3]].value,10),f=Math.floor(h/60),g=h%60;b.start_date=new Date(d[e[2]].value,d[e[1]].value,d[e[0]].value,f,g);f=g=0;dhtmlx.defined(e[3])&&(h=parseInt(d[e.size+e[3]].value,10),f=Math.floor(h/60),g=h%60);b.end_date=new Date(d[e[2]+e.size].value,d[e[1]+e.size].value,d[e[0]+e.size].value,f,g);if(b.end_date<=b.start_date)b.end_date=gantt.date.add(b.start_date,
gantt._get_timepicker_step(),"minute");return{start_date:new Date(b.start_date),end_date:new Date(b.end_date)}},focus:function(a){gantt._focus(a.getElementsByTagName("select")[0])}},duration:{render:function(a){var b=this.form_blocks.getTimePicker.call(this,a),b="<div class='dhx_time_selects'>"+b+"</div>",c=this.locale.labels[this._tasks.unit+"s"],d=a.single_date?' style="display:none"':"",e=a.readonly?" disabled='disabled'":"",f="<div class='dhx_gantt_duration' "+d+"><input type='button' class='dhx_gantt_duration_dec' value='-'"+
e+"><input type='text' value='5' class='dhx_gantt_duration_value'"+e+"><input type='button' class='dhx_gantt_duration_inc' value='+'"+e+"> "+c+" <span></span></div>",g="<div style='height:30px;padding-top:0px;font-size:inherit;' class='dhx_section_time'>"+b+" "+f+"</div>";return g},set_value:function(a,b,c,d){function e(){var b=gantt.form_blocks.duration._get_start_date.call(gantt,a,d),c=gantt.form_blocks.duration._get_duration.call(gantt,a,d),e=gantt.date.add(b,c,gantt._tasks.unit);n.innerHTML=gantt.templates.task_date(e)}
function f(a){var b=j.value,b=parseInt(b,10);window.isNaN(b)&&(b=0);b+=a;b<1&&(b=1);j.value=b;e()}var g=this.config,h=a.getElementsByTagName("select"),i=a.getElementsByTagName("input"),j=i[1],k=[i[0],i[2]],n=a.getElementsByTagName("span")[0],l=d._time_format_order;k[0].onclick=dhtmlx.bind(function(){f(-1*this.config.duration_step)},this);k[1].onclick=dhtmlx.bind(function(){f(1*this.config.duration_step)},this);h[0].onchange=e;h[1].onchange=e;h[2].onchange=e;if(h[3])h[3].onchange=e;j.onkeydown=dhtmlx.bind(function(a){var a=
a||window.event,b=a.charCode||a.keyCode||a.which;if(b==40)return f(-1*this.config.duration_step),!1;if(b==38)return f(1*this.config.duration_step),!1;window.setTimeout(function(){e()},1)},this);j.onchange=dhtmlx.bind(function(){e()},this);this.form_blocks._fill_lightbox_select(h,0,c.start_date,l,g);var m,o=gantt._tasks.unit;m=c.end_date?(c.end_date.valueOf()-c.start_date.valueOf())/(this._get_line(o)*1E3):c.duration;m=Math.round(m);j.value=m;e()},_get_start_date:function(a,b){var c=a.getElementsByTagName("select"),
d=b._time_format_order,e=0,f=0;if(dhtmlx.defined(d[3]))var g=parseInt(c[d[3]].value,10),e=Math.floor(g/60),f=g%60;return new Date(c[d[2]].value,c[d[1]].value,c[d[0]].value,e,f)},_get_duration:function(a){var b=a.getElementsByTagName("input")[1],b=parseInt(b.value,10);window.isNaN(b)&&(b=1);b<0&&(b*=-1);return b},get_value:function(a,b,c){b.start_date=this.form_blocks.duration._get_start_date(a,c);var d=this.form_blocks.duration._get_duration(a,c);b.end_date=this.date.add(b.start_date,d,this._tasks.unit);
b.duration=d;return{start_date:new Date(b.start_date),end_date:new Date(b.end_date)}},focus:function(a){gantt._focus(a.getElementsByTagName("select")[0])}},typeselect:{render:function(a){var b=gantt.config.types,c=gantt.locale.labels,d=[],e;for(e in b)d.push({key:b[e],label:c["type_"+e]});a.options=d;var f=a.onchange;a.onchange=function(){var a=gantt.getState().lightbox;gantt.changeLightboxType(a,this.value);typeof f=="function"&&f.apply(this,arguments)};return gantt.form_blocks.select.render.apply(this,
arguments)},set_value:function(){return gantt.form_blocks.select.set_value.apply(this,arguments)},get_value:function(){return gantt.form_blocks.select.get_value.apply(this,arguments)},focus:function(){return gantt.form_blocks.select.focus.apply(this,arguments)}}};gantt._is_lightbox_timepicker=function(){for(var a=this._get_typed_lightbox_config(),b=0;b<a.length;b++)if(a[b].name=="time"&&a[b].type=="time")return!0;return!1};
gantt._dhtmlx_confirm=function(a,b,c,d){if(!a)return c();var e={text:a};if(b)e.title=b;if(d)e.ok=d;if(c)e.callback=function(a){a&&c()};dhtmlx.confirm(e)};gantt._get_typed_lightbox_config=function(a){a===void 0&&(a=this.getLightboxType());return gantt.config.lightbox[a+"_sections"]?gantt.config.lightbox[a+"_sections"]:gantt.config.lightbox.sections};
gantt._silent_redraw_lightbox=function(a){if(this.getState().lightbox){var b=this.getLightboxValues(),c=dhtmlx.copy(this.getTask(a)),d=this.getLightboxType();this.resetLightbox();var e=dhtmlx.mixin(c,b,!0),f=this.getLightbox(e?e.type:void 0);this._set_lightbox_values(e,f);this._center_lightbox(this.getLightbox());this.callEvent("onLightboxTypeChange",[d,this.getLightboxType()])}};
function dataProcessor(a){this.serverProcessor=a;this.action_param="!nativeeditor_status";this.object=null;this.updatedRows=[];this.autoUpdate=!0;this.updateMode="cell";this._tMode="GET";this.post_delim="_";this._waitMode=0;this._in_progress={};this._invalid={};this.mandatoryFields=[];this.messages=[];this.styles={updated:"font-weight:bold;",inserted:"font-weight:bold;",deleted:"text-decoration : line-through;",invalid:"background-color:FFE0E0;",invalid_cell:"border-bottom:2px solid red;",error:"color:red;",
clear:"font-weight:normal;text-decoration:none;"};this.enableUTFencoding(!0);dhtmlxEventable(this);return this}
dataProcessor.prototype={setTransactionMode:function(a,b){this._tMode=a;this._tSend=b},escape:function(a){return this._utf?encodeURIComponent(a):escape(a)},enableUTFencoding:function(a){this._utf=convertStringToBoolean(a)},setDataColumns:function(a){this._columns=typeof a=="string"?a.split(","):a},getSyncState:function(){return!this.updatedRows.length},enableDataNames:function(a){this._endnm=convertStringToBoolean(a)},enablePartialDataSend:function(a){this._changed=convertStringToBoolean(a)},setUpdateMode:function(a,
b){this.autoUpdate=a=="cell";this.updateMode=a;this.dnd=b},ignore:function(a,b){this._silent_mode=!0;a.call(b||window);this._silent_mode=!1},setUpdated:function(a,b,c){if(!this._silent_mode){var d=this.findRow(a),c=c||"updated",e=this.obj.getUserData(a,this.action_param);e&&c=="updated"&&(c=e);b?(this.set_invalid(a,!1),this.updatedRows[d]=a,this.obj.setUserData(a,this.action_param,c),this._in_progress[a]&&(this._in_progress[a]="wait")):this.is_invalid(a)||(this.updatedRows.splice(d,1),this.obj.setUserData(a,
this.action_param,""));b||this._clearUpdateFlag(a);this.markRow(a,b,c);b&&this.autoUpdate&&this.sendData(a)}},_clearUpdateFlag:function(){},markRow:function(a,b,c){var d="",e=this.is_invalid(a);e&&(d=this.styles[e],b=!0);if(this.callEvent("onRowMark",[a,b,c,e])&&(d=this.styles[b?c:"clear"]+d,this.obj[this._methods[0]](a,d),e&&e.details)){d+=this.styles[e+"_cell"];for(var f=0;f<e.details.length;f++)if(e.details[f])this.obj[this._methods[1]](a,f,d)}},getState:function(a){return this.obj.getUserData(a,
this.action_param)},is_invalid:function(a){return this._invalid[a]},set_invalid:function(a,b,c){c&&(b={value:b,details:c,toString:function(){return this.value.toString()}});this._invalid[a]=b},checkBeforeUpdate:function(){return!0},sendData:function(a){if(!this._waitMode||!(this.obj.mytype=="tree"||this.obj._h2)){this.obj.editStop&&this.obj.editStop();if(typeof a=="undefined"||this._tSend)return this.sendAllData();if(this._in_progress[a])return!1;this.messages=[];if(!this.checkBeforeUpdate(a)&&this.callEvent("onValidationError",
[a,this.messages]))return!1;this._beforeSendData(this._getRowData(a),a)}},_beforeSendData:function(a,b){if(!this.callEvent("onBeforeUpdate",[b,this.getState(b),a]))return!1;this._sendData(a,b)},serialize:function(a,b){if(typeof a=="string")return a;if(typeof b!="undefined")return this.serialize_one(a,"");else{var c=[],d=[],e;for(e in a)a.hasOwnProperty(e)&&(c.push(this.serialize_one(a[e],e+this.post_delim)),d.push(e));c.push("ids="+this.escape(d.join(",")));dhtmlx.security_key&&c.push("dhx_security="+
dhtmlx.security_key);return c.join("&")}},serialize_one:function(a,b){if(typeof a=="string")return a;var c=[],d;for(d in a)a.hasOwnProperty(d)&&c.push(this.escape((b||"")+d)+"="+this.escape(a[d]));return c.join("&")},_sendData:function(a,b){if(a){if(!this.callEvent("onBeforeDataSending",b?[b,this.getState(b),a]:[null,null,a]))return!1;b&&(this._in_progress[b]=(new Date).valueOf());var c=new dtmlXMLLoaderObject(this.afterUpdate,this,!0),d=this.serverProcessor+(this._user?getUrlSymbol(this.serverProcessor)+
["dhx_user="+this._user,"dhx_version="+this.obj.getUserData(0,"version")].join("&"):"");this._tMode!="POST"?c.loadXML(d+(d.indexOf("?")!=-1?"&":"?")+this.serialize(a,b)):c.loadXML(d,!0,this.serialize(a,b));this._waitMode++}},sendAllData:function(){if(this.updatedRows.length){this.messages=[];for(var a=!0,b=0;b<this.updatedRows.length;b++)a&=this.checkBeforeUpdate(this.updatedRows[b]);if(!a&&!this.callEvent("onValidationError",["",this.messages]))return!1;if(this._tSend)this._sendData(this._getAllData());
else for(b=0;b<this.updatedRows.length;b++)if(!this._in_progress[this.updatedRows[b]]&&!this.is_invalid(this.updatedRows[b])&&(this._beforeSendData(this._getRowData(this.updatedRows[b]),this.updatedRows[b]),this._waitMode&&(this.obj.mytype=="tree"||this.obj._h2)))break}},_getAllData:function(){for(var a={},b=!1,c=0;c<this.updatedRows.length;c++){var d=this.updatedRows[c];!this._in_progress[d]&&!this.is_invalid(d)&&this.callEvent("onBeforeUpdate",[d,this.getState(d)])&&(a[d]=this._getRowData(d,d+this.post_delim),
b=!0,this._in_progress[d]=(new Date).valueOf())}return b?a:null},setVerificator:function(a,b){this.mandatoryFields[a]=b||function(a){return a!=""}},clearVerificator:function(a){this.mandatoryFields[a]=!1},findRow:function(a){for(var b=0,b=0;b<this.updatedRows.length;b++)if(a==this.updatedRows[b])break;return b},defineAction:function(a,b){if(!this._uActions)this._uActions=[];this._uActions[a]=b},afterUpdateCallback:function(a,b,c,d){var e=a,f=c!="error"&&c!="invalid";f||this.set_invalid(a,c);if(this._uActions&&
this._uActions[c]&&!this._uActions[c](d))return delete this._in_progress[e];this._in_progress[e]!="wait"&&this.setUpdated(a,!1);var g=a;switch(c){case "inserted":case "insert":b!=a&&(this.obj[this._methods[2]](a,b),a=b);break;case "delete":case "deleted":return this.obj.setUserData(a,this.action_param,"true_deleted"),this.obj[this._methods[3]](a),delete this._in_progress[e],this.callEvent("onAfterUpdate",[a,c,b,d])}this._in_progress[e]!="wait"?(f&&this.obj.setUserData(a,this.action_param,""),delete this._in_progress[e]):
(delete this._in_progress[e],this.setUpdated(b,!0,this.obj.getUserData(a,this.action_param)));this.callEvent("onAfterUpdate",[g,c,b,d])},afterUpdate:function(a,b,c,d,e){e.getXMLTopNode("data");if(e.xmlDoc.responseXML){for(var f=e.doXPath("//data/action"),g=0;g<f.length;g++){var h=f[g],i=h.getAttribute("type"),j=h.getAttribute("sid"),k=h.getAttribute("tid");a.afterUpdateCallback(j,k,i,h)}a.finalizeUpdate()}},finalizeUpdate:function(){this._waitMode&&this._waitMode--;(this.obj.mytype=="tree"||this.obj._h2)&&
this.updatedRows.length&&this.sendData();this.callEvent("onAfterUpdateFinish",[]);this.updatedRows.length||this.callEvent("onFullSync",[])},init:function(a){this.obj=a;this.obj._dp_init&&this.obj._dp_init(this)},setOnAfterUpdate:function(a){this.attachEvent("onAfterUpdate",a)},enableDebug:function(){},setOnBeforeUpdateHandler:function(a){this.attachEvent("onBeforeDataSending",a)},setAutoUpdate:function(a,b){a=a||2E3;this._user=b||(new Date).valueOf();this._need_update=!1;this._loader=null;this._update_busy=
!1;this.attachEvent("onAfterUpdate",function(a,b,c,g){this.afterAutoUpdate(a,b,c,g)});this.attachEvent("onFullSync",function(){this.fullSync()});var c=this;window.setInterval(function(){c.loadUpdate()},a)},afterAutoUpdate:function(a,b){return b=="collision"?(this._need_update=!0,!1):!0},fullSync:function(){if(this._need_update==!0)this._need_update=!1,this.loadUpdate();return!0},getUpdates:function(a,b){if(this._update_busy)return!1;else this._update_busy=!0;this._loader=this._loader||new dtmlXMLLoaderObject(!0);
this._loader.async=!0;this._loader.waitCall=b;this._loader.loadXML(a)},_v:function(a){return a.firstChild?a.firstChild.nodeValue:""},_a:function(a){for(var b=[],c=0;c<a.length;c++)b[c]=this._v(a[c]);return b},loadUpdate:function(){var a=this,b=this.obj.getUserData(0,"version"),c=this.serverProcessor+getUrlSymbol(this.serverProcessor)+["dhx_user="+this._user,"dhx_version="+b].join("&"),c=c.replace("editing=true&","");this.getUpdates(c,function(){var b=a._loader.doXPath("//userdata");a.obj.setUserData(0,
"version",a._v(b[0]));var c=a._loader.doXPath("//update");if(c.length){a._silent_mode=!0;for(var f=0;f<c.length;f++){var g=c[f].getAttribute("status"),h=c[f].getAttribute("id"),i=c[f].getAttribute("parent");switch(g){case "inserted":a.callEvent("insertCallback",[c[f],h,i]);break;case "updated":a.callEvent("updateCallback",[c[f],h,i]);break;case "deleted":a.callEvent("deleteCallback",[c[f],h,i])}}a._silent_mode=!1}a._update_busy=!1;a=null})}};
gantt.init=function(a,b,c){if(b&&c)this.config.start_date=this._min_date=new Date(b),this.config.end_date=this._max_date=new Date(c);this._init_skin();if(!this.config.scroll_size)this.config.scroll_size=this._detectScrollSize();this._reinit(a);this.attachEvent("onLoadEnd",this.render);dhtmlxEvent(window,"resize",this._on_resize);this.init=function(a){if(this.$container)this.$container.innerHTML="";this._reinit(a)};this.callEvent("onGanttReady",[])};
gantt._reinit=function(a){this._init_html_area(a);this._set_sizes();this._task_area_pulls={};this._task_area_renderers={};this._init_touch_events();this._init_templates();this._init_grid();this._init_tasks();this.render();this._set_scroll_events();dhtmlxEvent(this.$container,"click",this._on_click);dhtmlxEvent(this.$container,"dblclick",this._on_dblclick);dhtmlxEvent(this.$container,"mousemove",this._on_mousemove);dhtmlxEvent(this.$container,"contextmenu",this._on_contextmenu)};
gantt._init_html_area=function(a){this._obj=typeof a=="string"?document.getElementById(a):a;var b="<div class='gantt_container'><div class='gantt_grid'></div><div class='gantt_task'></div>";b+="<div class='gantt_ver_scroll'><div></div></div><div class='gantt_hor_scroll'><div></div></div></div>";this._obj.innerHTML=b;this.$container=this._obj.firstChild;var c=this.$container.childNodes;this.$grid=c[0];this.$task=c[1];this.$scroll_ver=c[2];this.$scroll_hor=c[3];this.$grid.innerHTML="<div class='gantt_grid_scale'></div><div class='gantt_grid_data'></div>";
this.$grid_scale=this.$grid.childNodes[0];this.$grid_data=this.$grid.childNodes[1];this.$task.innerHTML="<div class='gantt_task_scale'></div><div class='gantt_data_area'><div class='gantt_task_bg'></div><div class='gantt_links_area'></div><div class='gantt_bars_area'></div></div>";this.$task_scale=this.$task.childNodes[0];this.$task_data=this.$task.childNodes[1];this.$task_bg=this.$task_data.childNodes[0];this.$task_links=this.$task_data.childNodes[1];this.$task_bars=this.$task_data.childNodes[2]};
gantt.$click={buttons:{edit:function(a){gantt.showLightbox(a)},"delete":function(a){var b=gantt.locale.labels.confirm_deleting,c=gantt.locale.labels.confirm_deleting_title;gantt._dhtmlx_confirm(b,c,function(){gantt.deleteTask(a);gantt.hideLightbox()})}}};
gantt._set_sizes=function(){this._x=this._obj.clientWidth;this._y=this._obj.clientHeight;if(!(this._x<20||this._y<20)){this.$grid.style.height=this.$task.style.height=Math.max(this._y-this.$scroll_hor.offsetHeight-2,0)+"px";this.$grid_data.style.height=this.$task_data.style.height=Math.max(this._y-(this.config.scale_height||0)-this.$scroll_hor.offsetHeight-2,0)+"px";var a=Math.max(this.config.grid_width-1,0);this.$grid.style.width=a+"px";this.$grid.style.display=a==0?"none":"";this.$grid_data.style.width=
Math.max(this.config.grid_width-1,0)+"px";this.$task.style.width=Math.max(this._x-this.config.grid_width-2,0)+"px"}};gantt.getScrollState=function(){return{x:this.$task.scrollLeft,y:this.$task_data.scrollTop}};gantt.scrollTo=function(a,b){if(a!==null)this.$task.scrollLeft=a;if(b!==null)this.$task_data.scrollTop=b};gantt._on_resize=gantt.setSizes=function(){gantt._set_sizes();gantt._scroll_resize()};
gantt.render=function(){this._render_grid();this._render_tasks_scales();this._scroll_resize();this._on_resize();this._render_data();if(this.config.initial_scroll){var a=this._order[0]||0;a&&this.showTask(a)}};
gantt._set_scroll_events=function(){dhtmlxEvent(this.$scroll_hor,"scroll",function(){if(!gantt._touch_scroll_active){var a=gantt.$scroll_hor.scrollLeft;gantt._scroll_task_area(a)}});dhtmlxEvent(this.$scroll_ver,"scroll",function(){if(!gantt._touch_scroll_active){var a=gantt.$scroll_ver.scrollTop;gantt.$grid_data.scrollTop=a;gantt._scroll_task_area(null,a)}});dhtmlxEvent(this.$task,"scroll",function(){var a=gantt.$task.scrollLeft;gantt.$scroll_hor.scrollLeft=a});dhtmlxEvent(this.$task_data,"scroll",
function(){var a=gantt.$task_data.scrollTop;gantt.$scroll_ver.scrollTop=gantt.$grid_data.scrollTop=a});dhtmlxEvent(gantt.$container,"mousewheel",function(a){if(a.wheelDeltaX){var b=a.wheelDeltaX/-40,c=gantt.$task.scrollLeft+b*30;gantt._scroll_task_area(c,null);gantt.$scroll_hor.scrollTop=d}else{b=a.wheelDelta/-40;if(typeof a.wheelDelta=="undefined")b=a.detail;var d=gantt.$grid_data.scrollTop+b*30;gantt._scroll_task_area(null,d);gantt.$scroll_ver.scrollTop=d}a.preventDefault&&a.preventDefault();a.cancelBubble=
!0;return!1})};
gantt._scroll_resize=function(){if(!(this._x<20||this._y<20)){var a=this.config.grid_width,b=this._x-a,c=this._y-this.config.scale_height,d=this.$task_data.offsetWidth-this.config.scroll_size,e=this.config.row_height*this._order.length,f=d>b,g=e>c;this.$scroll_hor.style.display=f?"block":"none";this.$scroll_hor.style.height=(f?this.config.scroll_size:0)+"px";this.$scroll_hor.style.width=this._x-(g?this.config.scroll_size:2)+"px";this.$scroll_hor.firstChild.style.width=d+a+this.config.scroll_size+2+
"px";this.$scroll_ver.style.display=g?"block":"none";this.$scroll_ver.style.width=(g?this.config.scroll_size:0)+"px";this.$scroll_ver.style.height=this._y-(f?this.config.scroll_size:0)-this.config.scale_height+"px";this.$scroll_ver.style.top=this.config.scale_height+"px";this.$scroll_ver.firstChild.style.height=this.config.scale_height+e+"px"}};
gantt.locate=function(a,b){var c=gantt._get_target_node(a);if(c.className=="gantt_task_cell")return null;for(var d=b||this.config.task_attribute;c;){if(c.getAttribute){var e=c.getAttribute(d);if(e)return e}c=c.parentNode}return null};gantt._get_target_node=function(a){var b;a.tagName?b=a:(a=a||window.event,b=a.target||a.srcElement);return b};gantt._trim=function(a){var b=String.prototype.trim||function(){return this.replace(/^\s+|\s+$/g,"")};return b.apply(a)};
gantt._locate_css=function(a,b,c){c===void 0&&(c=!0);for(var d=gantt._get_target_node(a),e="",f=!1;d;){if(e=d.className){var g=e.indexOf(b);if(g>=0){if(!c)return d;var h=g===0||!gantt._trim(e.charAt(g-1)),i=g+b.length>=e.length||!gantt._trim(e.charAt(g+b.length));if(h&&i)return d}}d=d.parentNode}return null};gantt._locateHTML=function(a,b){for(var c=gantt._get_target_node(a),b=b||this.config.task_attribute;c;){if(c.getAttribute){var d=c.getAttribute(b);if(d)return c}c=c.parentNode}return null};
gantt.getTaskRowNode=function(a){for(var b=this.$grid_data.childNodes,c=this.config.task_attribute,d=0;d<b.length;d++)if(b[d].getAttribute){var e=b[d].getAttribute(c);if(e==a)return b[d]}return null};gantt.getState=function(){return{drag_id:this._tasks_dnd.drag.id,drag_mode:this._tasks_dnd.drag.mode,drag_from_start:this._tasks_dnd.drag.left,selected_task:this._selected_task,min_date:new Date(this._min_date),max_date:new Date(this._max_date),lightbox:this._lightbox_id}};
gantt._checkTimeout=function(a,b){if(!b)return!0;var c=1E3/b;if(c<1)return!0;if(a._on_timeout)return!1;setTimeout(function(){delete a._on_timeout},c);return a._on_timeout=!0};gantt.selectTask=function(a){if(this.config.select_task){if(a){if(this._selected_task==a)return this._selected_task;if(!this.callEvent("onBeforeTaskSelected",[a]))return!1;this.unselectTask();this._selected_task=a;this.refreshTask(a);this.callEvent("onTaskSelected",[a])}return this._selected_task}};
gantt.unselectTask=function(){var a=this._selected_task;if(a)this._selected_task=null,this.refreshTask(a),this.callEvent("onTaskUnselected",[a])};gantt.getSelectedId=function(){return dhtmlx.defined(this._selected_task)?this._selected_task:null};gantt.changeLightboxType=function(a,b){if(this.getLightboxType()==b)return!0;gantt._silent_redraw_lightbox(a)};
gantt.date={init:function(){for(var a=gantt.locale.date.month_short,b=gantt.locale.date.month_short_hash={},c=0;c<a.length;c++)b[a[c]]=c;a=gantt.locale.date.month_full;b=gantt.locale.date.month_full_hash={};for(c=0;c<a.length;c++)b[a[c]]=c},date_part:function(a){a.setHours(0);a.setMinutes(0);a.setSeconds(0);a.setMilliseconds(0);a.getHours()&&a.setTime(a.getTime()+36E5*(24-a.getHours()));return a},time_part:function(a){return(a.valueOf()/1E3-a.getTimezoneOffset()*60)%86400},week_start:function(a){var b=
a.getDay();gantt.config.start_on_monday&&(b===0?b=6:b--);return this.date_part(this.add(a,-1*b,"day"))},month_start:function(a){a.setDate(1);return this.date_part(a)},year_start:function(a){a.setMonth(0);return this.month_start(a)},day_start:function(a){return this.date_part(a)},hour_start:function(a){var b=a.getHours();this.day_start(a);a.setHours(b);return a},minute_start:function(a){var b=a.getMinutes();this.hour_start(a);a.setMinutes(b);return a},add:function(a,b,c){var d=new Date(a.valueOf());
switch(c){case "week":b*=7;case "day":d.setDate(d.getDate()+b);!a.getHours()&&d.getHours()&&d.setTime(d.getTime()+36E5*(24-d.getHours()));break;case "month":d.setMonth(d.getMonth()+b);break;case "year":d.setYear(d.getFullYear()+b);break;case "hour":d.setHours(d.getHours()+b);break;case "minute":d.setMinutes(d.getMinutes()+b);break;default:return gantt.date["add_"+c](a,b,c)}return d},to_fixed:function(a){return a<10?"0"+a:a},copy:function(a){return new Date(a.valueOf())},date_to_str:function(a,b){a=
a.replace(/%[a-zA-Z]/g,function(a){switch(a){case "%d":return'"+gantt.date.to_fixed(date.getDate())+"';case "%m":return'"+gantt.date.to_fixed((date.getMonth()+1))+"';case "%j":return'"+date.getDate()+"';case "%n":return'"+(date.getMonth()+1)+"';case "%y":return'"+gantt.date.to_fixed(date.getFullYear()%100)+"';case "%Y":return'"+date.getFullYear()+"';case "%D":return'"+gantt.locale.date.day_short[date.getDay()]+"';case "%l":return'"+gantt.locale.date.day_full[date.getDay()]+"';case "%M":return'"+gantt.locale.date.month_short[date.getMonth()]+"';
case "%F":return'"+gantt.locale.date.month_full[date.getMonth()]+"';case "%h":return'"+gantt.date.to_fixed((date.getHours()+11)%12+1)+"';case "%g":return'"+((date.getHours()+11)%12+1)+"';case "%G":return'"+date.getHours()+"';case "%H":return'"+gantt.date.to_fixed(date.getHours())+"';case "%i":return'"+gantt.date.to_fixed(date.getMinutes())+"';case "%a":return'"+(date.getHours()>11?"pm":"am")+"';case "%A":return'"+(date.getHours()>11?"PM":"AM")+"';case "%s":return'"+gantt.date.to_fixed(date.getSeconds())+"';
case "%W":return'"+gantt.date.to_fixed(gantt.date.getISOWeek(date))+"';default:return a}});b&&(a=a.replace(/date\.get/g,"date.getUTC"));return new Function("date",'return "'+a+'";')},str_to_date:function(a,b){for(var c="var temp=date.match(/[a-zA-Z]+|[0-9]+/g);",d=a.match(/%[a-zA-Z]/g),e=0;e<d.length;e++)switch(d[e]){case "%j":case "%d":c+="set[2]=temp["+e+"]||1;";break;case "%n":case "%m":c+="set[1]=(temp["+e+"]||1)-1;";break;case "%y":c+="set[0]=temp["+e+"]*1+(temp["+e+"]>50?1900:2000);";break;
case "%g":case "%G":case "%h":case "%H":c+="set[3]=temp["+e+"]||0;";break;case "%i":c+="set[4]=temp["+e+"]||0;";break;case "%Y":c+="set[0]=temp["+e+"]||0;";break;case "%a":case "%A":c+="set[3]=set[3]%12+((temp["+e+"]||'').toLowerCase()=='am'?0:12);";break;case "%s":c+="set[5]=temp["+e+"]||0;";break;case "%M":c+="set[1]=gantt.locale.date.month_short_hash[temp["+e+"]]||0;";break;case "%F":c+="set[1]=gantt.locale.date.month_full_hash[temp["+e+"]]||0;"}var f="set[0],set[1],set[2],set[3],set[4],set[5]";
b&&(f=" Date.UTC("+f+")");return new Function("date","var set=[0,0,1,0,0,0]; "+c+" return new Date("+f+");")},getISOWeek:function(a){if(!a)return!1;var b=a.getDay();b===0&&(b=7);var c=new Date(a.valueOf());c.setDate(a.getDate()+(4-b));var d=c.getFullYear(),e=Math.round((c.getTime()-(new Date(d,0,1)).getTime())/864E5),f=1+Math.floor(e/7);return f},getUTCISOWeek:function(a){return this.getISOWeek(a)},convert_to_utc:function(a){return new Date(a.getUTCFullYear(),a.getUTCMonth(),a.getUTCDate(),a.getUTCHours(),
a.getUTCMinutes(),a.getUTCSeconds())},parseDate:function(a,b){typeof a=="string"&&(dhtmlx.defined(b)&&(b=typeof b=="string"?dhtmlx.defined(gantt.templates[b])?gantt.templates[b]:gantt.date.str_to_date(b):gantt.templates.xml_date),a=b(a));return a}};if(!gantt.config)gantt.config={};if(!gantt.config)gantt.config={};if(!gantt.templates)gantt.templates={};
(function(){dhtmlx.mixin(gantt.config,{links:{finish_to_start:"0",start_to_start:"1",finish_to_finish:"2"},types:{task:"task",project:"project",milestone:"milestone"},duration_unit:"day",min_duration:36E5,xml_date:"%d-%m-%Y %H:%i",api_date:"%d-%m-%Y %H:%i",start_on_monday:!0,server_utc:!1,show_progress:!0,fit_tasks:!1,select_task:!0,readonly:!1,date_grid:"%Y-%m-%d",drag_links:!0,drag_progress:!0,drag_resize:!0,drag_move:!0,drag_mode:{resize:"resize",progress:"progress",move:"move",ignore:"ignore"},
round_dnd_dates:!0,link_wrapper_width:20,autofit:!0,columns:[{name:"text",tree:!0,width:"*"},{name:"start_date",align:"center"},{name:"duration",align:"center"},{name:"add",width:"44"}],step:1,scale_unit:"day",subscales:[],time_step:60,duration_step:1,date_scale:"%d %M",task_date:"%d %F %Y",time_picker:"%H:%i",task_attribute:"task_id",link_attribute:"link_id",buttons_left:["dhx_save_btn","dhx_cancel_btn"],buttons_right:["dhx_delete_btn"],lightbox:{sections:[{name:"description",height:70,map_to:"text",
type:"textarea",focus:!0},{name:"time",height:72,type:"duration",map_to:"auto"}],project_sections:[{name:"description",height:70,map_to:"text",type:"textarea",focus:!0},{name:"type",type:"typeselect",map_to:"type"},{name:"time",height:72,type:"duration",readonly:!0,map_to:"auto"}],milestone_sections:[{name:"description",height:70,map_to:"text",type:"textarea",focus:!0},{name:"type",type:"typeselect",map_to:"type"},{name:"time",height:72,type:"duration",single_date:!0,map_to:"auto"}]},drag_lightbox:!0,
sort:!1,details_on_create:!0,details_on_dblclick:!0,initial_scroll:!0,task_scroll_offset:100,task_height:"full",min_column_width:70});gantt.keys={edit_save:13,edit_cancel:27};gantt._init_template=function(a,b){if(this.config[a]&&!this.config[a].$used){if(!b||!this.templates[a])this.templates[a]=this.date.date_to_str(this.config[a]);this.config[a]=new String(this.config[a]);this.config[a].$used=!0}};gantt._init_templates=function(){var a=gantt.locale.labels;a.dhx_save_btn=a.icon_save;a.dhx_cancel_btn=
a.icon_cancel;a.dhx_delete_btn=a.icon_delete;var b=this.date.date_to_str,c=this.config;gantt._init_template("date_scale",!0);gantt._init_template("date_grid",!0);gantt._init_template("task_date",!0);dhtmlx.mixin(this.templates,{xml_date:this.date.str_to_date(c.xml_date,c.server_utc),xml_format:b(c.xml_date,c.server_utc),api_date:this.date.str_to_date(c.api_date),progress_text:function(){return""},grid_header_class:function(){return""},task_text:function(a,b,c){return c.text},task_class:function(){return""},
grid_row_class:function(){return""},task_row_class:function(){return""},task_cell_class:function(){return""},scale_cell_class:function(){return""},scale_row_class:function(){return""},task_class:function(){return""},grid_indent:function(){return"<div class='gantt_tree_indent'></div>"},grid_folder:function(a){return"<div class='gantt_tree_icon gantt_folder_"+(a.$open?"open":"closed")+"'></div>"},grid_file:function(){return"<div class='gantt_tree_icon gantt_file'></div>"},grid_open:function(a){return"<div class='gantt_tree_icon gantt_"+
(a.$open?"close":"open")+"'></div>"},grid_blank:function(){return"<div class='gantt_tree_icon gantt_blank'></div>"},task_time:function(a,b){return gantt.templates.task_date(a)+" - "+gantt.templates.task_date(b)},time_picker:b(c.time_picker),link_class:function(){return""},link_description:function(a){var b=gantt.getTask(a.source),c=gantt.getTask(a.target);return"<b>"+b.text+"</b> &ndash;  <b>"+c.text+"</b>"},drag_link:function(a,b,c,g){var a=gantt.getTask(a),h=gantt.locale.labels,i="<b>"+a.text+"</b> "+
(b?h.link_start:h.link_end)+"<br/>";c&&(c=gantt.getTask(c),i+="<b> "+c.text+"</b> "+(g?h.link_start:h.link_end)+"<br/>");return i},drag_link_class:function(a,b,c,g){var h="";if(a&&c)var i=gantt.isLinkAllowed(a,c,b,g),h=" "+(i?"gantt_link_allow":"gantt_link_deny");return"gantt_link_tooltip"+h}});this.callEvent("onTemplatesReady",[])}})();
window.jQuery&&function(a){var b=[];a.fn.dhx_gantt=function(c){c=c||{};if(typeof c==="string")if(b[c])return b[c].apply(this,[]);else a.error("Method "+c+" does not exist on jQuery.dhx_gantt");else{var d=[];this.each(function(){if(this&&this.getAttribute&&!this.getAttribute("dhxgantt")){for(var a in c)a!="data"&&(gantt.config[a]=c[a]);gantt.init(this);c.data&&gantt.parse(c.data);d.push(gantt)}});return d.length===1?d[0]:d}}}(jQuery);
if(window.dhtmlx){if(!dhtmlx.attaches)dhtmlx.attaches={};dhtmlx.attaches.attachGantt=function(a,b){var c=document.createElement("DIV");c.id="gantt_"+dhtmlx.uid();c.style.width="100%";c.style.height="100%";c.cmp="grid";document.body.appendChild(c);this.attachObject(c.id);var d=this.vs[this.av];d.grid=gantt;gantt.init(c.id,a,b);c.firstChild.style.border="none";d.gridId=c.id;d.gridObj=c;var e="_viewRestore";return this.vs[this[e]()].grid}}
gantt.locale={date:{month_full:"January,February,March,April,May,June,July,August,September,October,November,December".split(","),month_short:"Jan,Feb,Mar,Apr,May,Jun,Jul,Aug,Sep,Oct,Nov,Dec".split(","),day_full:"Sunday,Monday,Tuesday,Wednesday,Thursday,Friday,Saturday".split(","),day_short:"Sun,Mon,Tue,Wed,Thu,Fri,Sat".split(",")},labels:{new_task:"New task",icon_save:"Save",icon_cancel:"Cancel",icon_details:"Details",icon_edit:"Edit",icon_delete:"Delete",confirm_closing:"",confirm_deleting:"Task will be deleted permanently, are you sure?",
section_description:"Description",section_time:"Time period",section_type:"Type",column_text:"Task name",column_start_date:"Start time",column_duration:"Duration",column_add:"",link:"Link",confirm_link_deleting:"will be deleted",link_start:" (start)",link_end:" (end)",type_task:"Task",type_project:"Project",type_milestone:"Milestone",minutes:"Minutes",hours:"Hours",days:"Days",weeks:"Week",months:"Months",years:"Years"}};
gantt.skins.skyblue={config:{grid_width:350,row_height:27,scale_height:27,task_height:24,link_line_width:1,link_arrow_size:8,lightbox_additional_height:75},_second_column_width:95,_third_column_width:80};gantt.skins.meadow={config:{grid_width:350,row_height:27,scale_height:30,task_height:24,link_line_width:2,link_arrow_size:6,lightbox_additional_height:72},_second_column_width:95,_third_column_width:80};
gantt.skins.terrace={config:{grid_width:360,row_height:35,scale_height:35,task_height:24,link_line_width:2,link_arrow_size:6,lightbox_additional_height:75},_second_column_width:90,_third_column_width:70};
gantt.skins.broadway={config:{grid_width:360,row_height:35,scale_height:35,task_height:24,link_line_width:1,link_arrow_size:7,lightbox_additional_height:86},_second_column_width:90,_third_column_width:80,_lightbox_template:"<div class='dhx_cal_ltitle'><span class='dhx_mark'>&nbsp;</span><span class='dhx_time'></span><span class='dhx_title'></span><div class='dhx_cancel_btn'></div></div><div class='dhx_cal_larea'></div>",_config_buttons_left:{},_config_buttons_right:{dhx_delete_btn:"icon_delete",dhx_save_btn:"icon_save"}};
gantt.config.touch_drag=50;gantt.config.touch=!0;
gantt._init_touch_events=function(){if(this.config.touch!="force")this.config.touch=this.config.touch&&(navigator.userAgent.indexOf("Mobile")!=-1||navigator.userAgent.indexOf("iPad")!=-1||navigator.userAgent.indexOf("Android")!=-1||navigator.userAgent.indexOf("Touch")!=-1);this.config.touch&&(window.navigator.msPointerEnabled?this._touch_events(["MSPointerMove","MSPointerDown","MSPointerUp"],function(a){return a.pointerType==a.MSPOINTER_TYPE_MOUSE?null:a},function(a){return!a||a.pointerType==a.MSPOINTER_TYPE_MOUSE}):
this._touch_events(["touchmove","touchstart","touchend"],function(a){return a.touches&&a.touches.length>1?null:a.touches[0]?{target:a.target,pageX:a.touches[0].pageX,pageY:a.touches[0].pageY}:a},function(){return!1}))};
gantt._touch_events=function(a,b,c){function d(a){a&&a.preventDefault&&a.preventDefault();(a||event).cancelBubble=!0;return!1}var e=0,f=!1,g=!1,h=0,i=null,j;if(!this._gantt_touch_event_ready)this._gantt_touch_event_ready=1,dhtmlxEvent(document.body,a[0],function(a){if(!c(a)&&f){var h=b(a);if(h&&i){var l=i.pageX-h.pageX,m=i.pageY-h.pageY;if(!g&&(Math.abs(l)>5||Math.abs(m)>5))gantt._touch_scroll_active=g=!0,e=0,j=gantt.getScrollState();g&&gantt.scrollTo(j.x+l,j.y+m)}return d(a)}});dhtmlxEvent(this.$container,
"contextmenu",function(a){if(f)return d(a)});dhtmlxEvent(this.$container,a[1],function(a){if(!c(a))if(a.touches&&a.touches.length>1)f=!1;else if(f=!0,(i=b(a))&&e){var g=new Date;g-e<500?(gantt._on_dblclick(i),d(a)):e=g}else e=new Date});dhtmlxEvent(this.$container,a[2],function(a){if(!c(a))gantt._touch_scroll_active=f=g=!1})};
